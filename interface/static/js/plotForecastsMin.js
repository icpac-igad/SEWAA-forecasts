var hdf5=(()=>{var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s),i={};function s(e,t,i=0){var s=new Map;for(let[a,n]of e.entries()){let e=h.unpack_from("<"+n,t,i);i+=h.calcsize(n),1==e.length&&(e=e[0]),s.set(a,e)}return s}function a(e){e||e()}function n(e){var t="<"+Array.from(e.values()).join("");return h.calcsize(t)}function r(e,t=8){return Math.ceil(e/t)*t}((t,i)=>{for(var s in(t=>{e(t,"__esModule",{value:!0})})(t),i)e(t,s,{get:i[s],enumerable:!0})})(i,{Dataset:()=>Ns,File:()=>Fs,Filters:()=>vi,Group:()=>Rs});var l={u:"Uint",i:"Int",f:"Float"};function o(e){var t,i,s=h._is_big_endian(e);if(/S/.test(e))t="getString",i=0|((e.match(/S(\d*)/)||[])[1]||1);else{let[s,a,n]=e.match(/[<>=!@]?(i|u|f)(\d*)/);i=parseInt(n||4,10),t="get"+l[a]+(8*i).toFixed()}return[t,s,i]}var h=new class{constructor(){this.big_endian=function(){const e=new Uint8Array(4);return!((new Uint32Array(e.buffer)[0]=1)&e[0])}(),this.getters={s:"getUint8",b:"getInt8",B:"getUint8",h:"getInt16",H:"getUint16",i:"getInt32",I:"getUint32",l:"getInt32",L:"getUint32",q:"getInt64",Q:"getUint64",f:"getFloat32",d:"getFloat64"},this.byte_lengths={s:1,b:1,B:1,h:2,H:2,i:4,I:4,l:4,L:4,q:8,Q:8,f:4,d:8};let e=Object.keys(this.byte_lengths).join("");this.fmt_size_regex="(\\d*)(["+e+"])"}calcsize(e){for(var t,i=0,s=new RegExp(this.fmt_size_regex,"g");null!==(t=s.exec(e));){let e=parseInt(t[1]||1,10),s=t[2];i+=e*this.byte_lengths[s]}return i}_is_big_endian(e){return!/^</.test(e)&&(!!/^(!|>)/.test(e)||this.big_endian)}unpack_from(e,t,i){i=Number(i||0);for(var s,a=new d(t,0),n=[],r=this._is_big_endian(e),l=new RegExp(this.fmt_size_regex,"g");null!==(s=l.exec(e));){let e=parseInt(s[1]||1,10),l=s[2],h=this.getters[l],d=this.byte_lengths[l];if("s"==l)n.push((new TextDecoder).decode(t.slice(i,i+e))),i+=e;else for(var o=0;o<e;o++)n.push(a[h](i,!r)),i+=d}return n}};var d=class extends DataView{getUint64(e,t){const i=BigInt(this.getUint32(e,t)),s=BigInt(this.getUint32(e+4,t));let a=t?i+(s<<32n):(i<<32n)+s;return Number(a)}getInt64(e,t){var i,s;t?(i=this.getUint32(e,!0),s=this.getInt32(e+4,!0)):(s=this.getInt32(e,!1),i=this.getUint32(e+4,!1));let a=BigInt(i)+(BigInt(s)<<32n);return Number(a)}getString(e,t,i){const s=this.buffer.slice(e,e+i);return(new TextDecoder).decode(s)}getVLENStruct(e,t,i){return[this.getUint32(e,t),this.getUint64(e+4,t),this.getUint32(e+12,t)]}};function _(e){return e.toString(2).length}function c(e,t,i=0,s=!0){let a=new Uint8Array(t.slice(i,i+e));return s||a.reverse(),a.reduce(((e,t,i)=>e+(t<<8*i)),0)}var u=class{constructor(e,t){this.buf=e,this.offset=t,this.dtype=this.determine_dtype()}determine_dtype(){let e=s(f,this.buf,this.offset);this.offset+=g;let t=15&e.get("class_and_version");if(t==p)return this._determine_dtype_fixed_point(e);if(t==b)return this._determine_dtype_floating_point(e);if(t==m)throw"Time datatype class not supported.";if(t==w)return this._determine_dtype_string(e);if(t==k)throw"Bitfield datatype class not supported.";if(t==y)throw"Opaque datatype class not supported.";if(t==v)return this._determine_dtype_compound(e);if(t==x)return["REFERENCE",e.get("size")];if(t==z)return this.determine_dtype();if(t==S)throw"Array datatype class not supported.";if(t==L){let t=this._determine_dtype_vlen(e);if("VLEN_SEQUENCE"==t[0]){t=["VLEN_SEQUENCE",this.determine_dtype()]}return t}throw"Invalid datatype class "+t}_determine_dtype_fixed_point(e){let t=e.get("size");if(![1,2,4,8].includes(t))throw"Unsupported datatype size";var i;var s;return i=(8&e.get("class_bit_field_0"))>0?"i":"u",s=0==(1&e.get("class_bit_field_0"))?"<":">",this.offset+=4,s+i+t.toFixed()}_determine_dtype_floating_point(e){let t=e.get("size");if(![1,2,4,8].includes(t))throw"Unsupported datatype size";var i;return i=0==(1&e.get("class_bit_field_0"))?"<":">",this.offset+=12,i+"f"+t.toFixed()}_determine_dtype_string(e){return"S"+e.get("size").toFixed()}_determine_dtype_vlen(e){return 1!=(1&e.get("class_bit_field_0"))?["VLEN_SEQUENCE",0,0]:["VLEN_STRING",e.get("class_bit_field_0")>>4,1&e.get("class_bit_field_1")]}_determine_dtype_compound(e){throw"Compound type not yet implemented!"}},f=new Map([["class_and_version","B"],["class_bit_field_0","B"],["class_bit_field_1","B"],["class_bit_field_2","B"],["size","I"]]),g=n(f),p=(n(new Map([["offset","I"],["dimensionality","B"],["reserved_0","B"],["reserved_1","B"],["reserved_2","B"],["permutation","I"],["reserved_3","I"],["dim_size_1","I"],["dim_size_2","I"],["dim_size_3","I"],["dim_size_4","I"]])),0),b=1,m=2,w=3,k=4,y=5,v=6,x=7,z=8,L=9,S=10;function A(e){let t=e.length;for(;--t>=0;)e[t]=0}var T=256,B=286,E=30,C=15,I=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),R=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),M=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),N=new Array(576);A(N);var U=new Array(60);A(U);var D=new Array(512);A(D);var P=new Array(256);A(P);var j=new Array(29);A(j);var O,H,Q,Z=new Array(E);function V(e,t,i,s,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=a,this.has_stree=e&&e.length}function W(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}A(Z);var G=e=>e<256?D[e]:D[256+(e>>>7)],K=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},Y=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,K(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},q=(e,t,i)=>{Y(e,i[2*t],i[2*t+1])},$=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},X=(e,t,i)=>{const s=new Array(16);let a,n,r=0;for(a=1;a<=C;a++)s[a]=r=r+i[a-1]<<1;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=$(s[t]++,t))}},J=e=>{let t;for(t=0;t<B;t++)e.dyn_ltree[2*t]=0;for(t=0;t<E;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},ee=e=>{e.bi_valid>8?K(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},te=(e,t,i,s)=>{const a=2*t,n=2*i;return e[a]<e[n]||e[a]===e[n]&&s[t]<=s[i]},ie=(e,t,i)=>{const s=e.heap[i];let a=i<<1;for(;a<=e.heap_len&&(a<e.heap_len&&te(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!te(t,s,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=s},se=(e,t,i)=>{let s,a,n,r,l=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*l]<<8|e.pending_buf[e.d_buf+2*l+1],a=e.pending_buf[e.l_buf+l],l++,0===s?q(e,a,t):(n=P[a],q(e,n+T+1,t),r=I[n],0!==r&&(a-=j[n],Y(e,a,r)),s--,n=G(s),q(e,n,i),r=R[n],0!==r&&(s-=Z[n],Y(e,s,r)))}while(l<e.last_lit);q(e,256,t)},ae=(e,t)=>{const i=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,n=t.stat_desc.elems;let r,l,o,h=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<n;r++)0!==i[2*r]?(e.heap[++e.heap_len]=h=r,e.depth[r]=0):i[2*r+1]=0;for(;e.heap_len<2;)o=e.heap[++e.heap_len]=h<2?++h:0,i[2*o]=1,e.depth[o]=0,e.opt_len--,a&&(e.static_len-=s[2*o+1]);for(t.max_code=h,r=e.heap_len>>1;r>=1;r--)ie(e,i,r);o=n;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ie(e,i,1),l=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=l,i[2*o]=i[2*r]+i[2*l],e.depth[o]=(e.depth[r]>=e.depth[l]?e.depth[r]:e.depth[l])+1,i[2*r+1]=i[2*l+1]=o,e.heap[1]=o++,ie(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,s=t.max_code,a=t.stat_desc.static_tree,n=t.stat_desc.has_stree,r=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,o=t.stat_desc.max_length;let h,d,_,c,u,f,g=0;for(c=0;c<=C;c++)e.bl_count[c]=0;for(i[2*e.heap[e.heap_max]+1]=0,h=e.heap_max+1;h<573;h++)d=e.heap[h],c=i[2*i[2*d+1]+1]+1,c>o&&(c=o,g++),i[2*d+1]=c,d>s||(e.bl_count[c]++,u=0,d>=l&&(u=r[d-l]),f=i[2*d],e.opt_len+=f*(c+u),n&&(e.static_len+=f*(a[2*d+1]+u)));if(0!==g){do{for(c=o-1;0===e.bl_count[c];)c--;e.bl_count[c]--,e.bl_count[c+1]+=2,e.bl_count[o]--,g-=2}while(g>0);for(c=o;0!==c;c--)for(d=e.bl_count[c];0!==d;)_=e.heap[--h],_>s||(i[2*_+1]!==c&&(e.opt_len+=(c-i[2*_+1])*i[2*_],i[2*_+1]=c),d--)}})(e,t),X(i,h,e.bl_count)},ne=(e,t,i)=>{let s,a,n=-1,r=t[1],l=0,o=7,h=4;for(0===r&&(o=138,h=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)a=r,r=t[2*(s+1)+1],++l<o&&a===r||(l<h?e.bl_tree[2*a]+=l:0!==a?(a!==n&&e.bl_tree[2*a]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,n=a,0===r?(o=138,h=3):a===r?(o=6,h=3):(o=7,h=4))},re=(e,t,i)=>{let s,a,n=-1,r=t[1],l=0,o=7,h=4;for(0===r&&(o=138,h=3),s=0;s<=i;s++)if(a=r,r=t[2*(s+1)+1],!(++l<o&&a===r)){if(l<h)do{q(e,a,e.bl_tree)}while(0!=--l);else 0!==a?(a!==n&&(q(e,a,e.bl_tree),l--),q(e,16,e.bl_tree),Y(e,l-3,2)):l<=10?(q(e,17,e.bl_tree),Y(e,l-3,3)):(q(e,18,e.bl_tree),Y(e,l-11,7));l=0,n=a,0===r?(o=138,h=3):a===r?(o=6,h=3):(o=7,h=4)}},le=!1,oe=(e,t,i,s)=>{Y(e,0+(s?1:0),3),((e,t,i,s)=>{ee(e),s&&(K(e,i),K(e,~i)),e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i})(e,t,i,!0)},he={_tr_init:e=>{le||((()=>{let e,t,i,s,a;const n=new Array(16);for(i=0,s=0;s<28;s++)for(j[s]=i,e=0;e<1<<I[s];e++)P[i++]=s;for(P[i-1]=s,a=0,s=0;s<16;s++)for(Z[s]=a,e=0;e<1<<R[s];e++)D[a++]=s;for(a>>=7;s<E;s++)for(Z[s]=a<<7,e=0;e<1<<R[s]-7;e++)D[256+a++]=s;for(t=0;t<=C;t++)n[t]=0;for(e=0;e<=143;)N[2*e+1]=8,e++,n[8]++;for(;e<=255;)N[2*e+1]=9,e++,n[9]++;for(;e<=279;)N[2*e+1]=7,e++,n[7]++;for(;e<=287;)N[2*e+1]=8,e++,n[8]++;for(X(N,287,n),e=0;e<E;e++)U[2*e+1]=5,U[2*e]=$(e,5);O=new V(N,I,257,B,C),H=new V(U,R,0,E,C),Q=new V(new Array(0),M,0,19,7)})(),le=!0),e.l_desc=new W(e.dyn_ltree,O),e.d_desc=new W(e.dyn_dtree,H),e.bl_desc=new W(e.bl_tree,Q),e.bi_buf=0,e.bi_valid=0,J(e)},_tr_stored_block:oe,_tr_flush_block:(e,t,i,s)=>{let a,n,r=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<T;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ae(e,e.l_desc),ae(e,e.d_desc),r=(e=>{let t;for(ne(e,e.dyn_ltree,e.l_desc.max_code),ne(e,e.dyn_dtree,e.d_desc.max_code),ae(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*F[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=a&&(a=n)):a=n=i+5,i+4<=a&&-1!==t?oe(e,t,i,s):4===e.strategy||n===a?(Y(e,2+(s?1:0),3),se(e,N,U)):(Y(e,4+(s?1:0),3),((e,t,i,s)=>{let a;for(Y(e,t-257,5),Y(e,i-1,5),Y(e,s-4,4),a=0;a<s;a++)Y(e,e.bl_tree[2*F[a]+1],3);re(e,e.dyn_ltree,t-1),re(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,r+1),se(e,e.dyn_ltree,e.dyn_dtree)),J(e),s&&ee(e)},_tr_tally:(e,t,i)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(P[i]+T+1)]++,e.dyn_dtree[2*G(t)]++),e.last_lit===e.lit_bufsize-1),_tr_align:e=>{Y(e,2,3),q(e,256,N),(e=>{16===e.bi_valid?(K(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},de=(e,t,i,s)=>{let a=65535&e|0,n=e>>>16&65535|0,r=0;for(;0!==i;){r=i>2e3?2e3:i,i-=r;do{a=a+t[s++]|0,n=n+a|0}while(--r);a%=65521,n%=65521}return a|n<<16|0},_e=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})()),ce=(e,t,i,s)=>{const a=_e,n=s+i;e^=-1;for(let i=s;i<n;i++)e=e>>>8^a[255&(e^t[i])];return-1^e},ue={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},fe={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:ge,_tr_stored_block:pe,_tr_flush_block:be,_tr_tally:me,_tr_align:we}=he,{Z_NO_FLUSH:ke,Z_PARTIAL_FLUSH:ye,Z_FULL_FLUSH:ve,Z_FINISH:xe,Z_BLOCK:ze,Z_OK:Le,Z_STREAM_END:Se,Z_STREAM_ERROR:Ae,Z_DATA_ERROR:Te,Z_BUF_ERROR:Be,Z_DEFAULT_COMPRESSION:Ee,Z_FILTERED:Ce,Z_HUFFMAN_ONLY:Ie,Z_RLE:Re,Z_FIXED:Me,Z_DEFAULT_STRATEGY:Fe,Z_UNKNOWN:Ne,Z_DEFLATED:Ue}=fe,De=258,Pe=262,je=103,Oe=113,He=666,Qe=(e,t)=>(e.msg=ue[t],t),Ze=e=>(e<<1)-(e>4?9:0),Ve=e=>{let t=e.length;for(;--t>=0;)e[t]=0},We=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask,Ge=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},Ke=(e,t)=>{be(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ge(e.strm)},Ye=(e,t)=>{e.pending_buf[e.pending++]=t},qe=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},$e=(e,t,i,s)=>{let a=e.avail_in;return a>s&&(a=s),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),i),1===e.state.wrap?e.adler=de(e.adler,t,a,i):2===e.state.wrap&&(e.adler=ce(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)},Xe=(e,t)=>{let i,s,a=e.max_chain_length,n=e.strstart,r=e.prev_length,l=e.nice_match;const o=e.strstart>e.w_size-Pe?e.strstart-(e.w_size-Pe):0,h=e.window,d=e.w_mask,_=e.prev,c=e.strstart+De;let u=h[n+r-1],f=h[n+r];e.prev_length>=e.good_match&&(a>>=2),l>e.lookahead&&(l=e.lookahead);do{if(i=t,h[i+r]===f&&h[i+r-1]===u&&h[i]===h[n]&&h[++i]===h[n+1]){n+=2,i++;do{}while(h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&n<c);if(s=De-(c-n),n=c-De,s>r){if(e.match_start=t,r=s,s>=l)break;u=h[n+r-1],f=h[n+r]}}}while((t=_[t&d])>o&&0!=--a);return r<=e.lookahead?r:e.lookahead},Je=e=>{const t=e.w_size;let i,s,a,n,r;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Pe)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,s=e.hash_size,i=s;do{a=e.head[--i],e.head[i]=a>=t?a-t:0}while(--s);s=t,i=s;do{a=e.prev[--i],e.prev[i]=a>=t?a-t:0}while(--s);n+=t}if(0===e.strm.avail_in)break;if(s=$e(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=s,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=We(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=We(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Pe&&0!==e.strm.avail_in)},et=(e,t)=>{let i,s;for(;;){if(e.lookahead<Pe){if(Je(e),e.lookahead<Pe&&t===ke)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=We(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-Pe&&(e.match_length=Xe(e,i)),e.match_length>=3)if(s=me(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=We(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=We(e,e.ins_h,e.window[e.strstart+1]);else s=me(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(Ke(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===xe?(Ke(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ke(e,!1),0===e.strm.avail_out)?1:2},tt=(e,t)=>{let i,s,a;for(;;){if(e.lookahead<Pe){if(Je(e),e.lookahead<Pe&&t===ke)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=We(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-Pe&&(e.match_length=Xe(e,i),e.match_length<=5&&(e.strategy===Ce||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,s=me(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=We(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(Ke(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=me(e,0,e.window[e.strstart-1]),s&&Ke(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=me(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===xe?(Ke(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ke(e,!1),0===e.strm.avail_out)?1:2};function it(e,t,i,s,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=a}var st=[new it(0,0,0,0,((e,t)=>{let i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Je(e),0===e.lookahead&&t===ke)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const s=e.block_start+i;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,Ke(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-Pe&&(Ke(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===xe?(Ke(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Ke(e,!1),e.strm.avail_out),1)})),new it(4,4,8,4,et),new it(4,5,16,8,et),new it(4,6,32,32,et),new it(4,4,16,16,tt),new it(8,16,32,32,tt),new it(8,16,128,128,tt),new it(8,32,128,256,tt),new it(32,128,258,1024,tt),new it(32,258,258,4096,tt)];function at(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Ue,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ve(this.dyn_ltree),Ve(this.dyn_dtree),Ve(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ve(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ve(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var nt=e=>{if(!e||!e.state)return Qe(e,Ae);e.total_in=e.total_out=0,e.data_type=Ne;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:Oe,e.adler=2===t.wrap?0:1,t.last_flush=ke,ge(t),Le},rt=e=>{const t=nt(e);var i;return t===Le&&((i=e.state).window_size=2*i.w_size,Ve(i.head),i.max_lazy_match=st[i.level].max_lazy,i.good_match=st[i.level].good_length,i.nice_match=st[i.level].nice_length,i.max_chain_length=st[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t},lt=(e,t,i,s,a,n)=>{if(!e)return Ae;let r=1;if(t===Ee&&(t=6),s<0?(r=0,s=-s):s>15&&(r=2,s-=16),a<1||a>9||i!==Ue||s<8||s>15||t<0||t>9||n<0||n>Me)return Qe(e,Ae);8===s&&(s=9);const l=new at;return e.state=l,l.strm=e,l.wrap=r,l.gzhead=null,l.w_bits=s,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=n,l.method=i,rt(e)},ot={deflateInit:(e,t)=>lt(e,t,Ue,15,8,Fe),deflateInit2:lt,deflateReset:rt,deflateResetKeep:nt,deflateSetHeader:(e,t)=>e&&e.state?2!==e.state.wrap?Ae:(e.state.gzhead=t,Le):Ae,deflate:(e,t)=>{let i,s;if(!e||!e.state||t>ze||t<0)return e?Qe(e,Ae):Ae;const a=e.state;if(!e.output||!e.input&&0!==e.avail_in||a.status===He&&t!==xe)return Qe(e,0===e.avail_out?Be:Ae);a.strm=e;const n=a.last_flush;if(a.last_flush=t,42===a.status)if(2===a.wrap)e.adler=0,Ye(a,31),Ye(a,139),Ye(a,8),a.gzhead?(Ye(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),Ye(a,255&a.gzhead.time),Ye(a,a.gzhead.time>>8&255),Ye(a,a.gzhead.time>>16&255),Ye(a,a.gzhead.time>>24&255),Ye(a,9===a.level?2:a.strategy>=Ie||a.level<2?4:0),Ye(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(Ye(a,255&a.gzhead.extra.length),Ye(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=ce(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(Ye(a,0),Ye(a,0),Ye(a,0),Ye(a,0),Ye(a,0),Ye(a,9===a.level?2:a.strategy>=Ie||a.level<2?4:0),Ye(a,3),a.status=Oe);else{let t=Ue+(a.w_bits-8<<4)<<8,i=-1;i=a.strategy>=Ie||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=i<<6,0!==a.strstart&&(t|=32),t+=31-t%31,a.status=Oe,qe(a,t),0!==a.strstart&&(qe(a,e.adler>>>16),qe(a,65535&e.adler)),e.adler=1}if(69===a.status)if(a.gzhead.extra){for(i=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),Ge(e),i=a.pending,a.pending!==a.pending_buf_size));)Ye(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){i=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),Ge(e),i=a.pending,a.pending===a.pending_buf_size)){s=1;break}s=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,Ye(a,s)}while(0!==s);a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),0===s&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){i=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),Ge(e),i=a.pending,a.pending===a.pending_buf_size)){s=1;break}s=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,Ye(a,s)}while(0!==s);a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),0===s&&(a.status=je)}else a.status=je;if(a.status===je&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&Ge(e),a.pending+2<=a.pending_buf_size&&(Ye(a,255&e.adler),Ye(a,e.adler>>8&255),e.adler=0,a.status=Oe)):a.status=Oe),0!==a.pending){if(Ge(e),0===e.avail_out)return a.last_flush=-1,Le}else if(0===e.avail_in&&Ze(t)<=Ze(n)&&t!==xe)return Qe(e,Be);if(a.status===He&&0!==e.avail_in)return Qe(e,Be);if(0!==e.avail_in||0!==a.lookahead||t!==ke&&a.status!==He){let i=a.strategy===Ie?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(Je(e),0===e.lookahead)){if(t===ke)return 1;break}if(e.match_length=0,i=me(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(Ke(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===xe?(Ke(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ke(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===Re?((e,t)=>{let i,s,a,n;const r=e.window;for(;;){if(e.lookahead<=De){if(Je(e),e.lookahead<=De&&t===ke)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,s=r[a],s===r[++a]&&s===r[++a]&&s===r[++a])){n=e.strstart+De;do{}while(s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&s===r[++a]&&a<n);e.match_length=De-(n-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=me(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=me(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(Ke(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===xe?(Ke(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Ke(e,!1),0===e.strm.avail_out)?1:2})(a,t):st[a.level].func(a,t);if(3!==i&&4!==i||(a.status=He),1===i||3===i)return 0===e.avail_out&&(a.last_flush=-1),Le;if(2===i&&(t===ye?we(a):t!==ze&&(pe(a,0,0,!1),t===ve&&(Ve(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),Ge(e),0===e.avail_out))return a.last_flush=-1,Le}return t!==xe?Le:a.wrap<=0?Se:(2===a.wrap?(Ye(a,255&e.adler),Ye(a,e.adler>>8&255),Ye(a,e.adler>>16&255),Ye(a,e.adler>>24&255),Ye(a,255&e.total_in),Ye(a,e.total_in>>8&255),Ye(a,e.total_in>>16&255),Ye(a,e.total_in>>24&255)):(qe(a,e.adler>>>16),qe(a,65535&e.adler)),Ge(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?Le:Se)},deflateEnd:e=>{if(!e||!e.state)return Ae;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==je&&t!==Oe&&t!==He?Qe(e,Ae):(e.state=null,t===Oe?Qe(e,Te):Le)},deflateSetDictionary:(e,t)=>{let i=t.length;if(!e||!e.state)return Ae;const s=e.state,a=s.wrap;if(2===a||1===a&&42!==s.status||s.lookahead)return Ae;if(1===a&&(e.adler=de(e.adler,t,i,0)),s.wrap=0,i>=s.w_size){0===a&&(Ve(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(i-s.w_size,i),0),t=e,i=s.w_size}const n=e.avail_in,r=e.next_in,l=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Je(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=We(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,Je(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=r,e.input=l,e.avail_in=n,s.wrap=a,Le},deflateInfo:"pako deflate (from Nodeca project)"},ht=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),dt={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)ht(i,t)&&(e[t]=i[t])}}return e},flattenChunks:e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,s=0,a=e.length;t<a;t++){let a=e[t];i.set(a,s),s+=a.length}return i}},_t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){_t=!1}var ct=new Uint8Array(256);for(let e=0;e<256;e++)ct[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ct[254]=ct[254]=1;var ut={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,s,a,n,r=e.length,l=0;for(a=0;a<r;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<r&&(s=e.charCodeAt(a+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),a++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(l),n=0,a=0;n<l;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<r&&(s=e.charCodeAt(a+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),a++)),i<128?t[n++]=i:i<2048?(t[n++]=192|i>>>6,t[n++]=128|63&i):i<65536?(t[n++]=224|i>>>12,t[n++]=128|i>>>6&63,t[n++]=128|63&i):(t[n++]=240|i>>>18,t[n++]=128|i>>>12&63,t[n++]=128|i>>>6&63,t[n++]=128|63&i);return t},buf2string:(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,a;const n=new Array(2*i);for(a=0,s=0;s<i;){let t=e[s++];if(t<128){n[a++]=t;continue}let r=ct[t];if(r>4)n[a++]=65533,s+=r-1;else{for(t&=2===r?31:3===r?15:7;r>1&&s<i;)t=t<<6|63&e[s++],r--;r>1?n[a++]=65533:t<65536?n[a++]=t:(t-=65536,n[a++]=55296|t>>10&1023,n[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&_t)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i})(n,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+ct[e[i]]>t?i:t}};var ft=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},gt=Object.prototype.toString,{Z_NO_FLUSH:pt,Z_SYNC_FLUSH:bt,Z_FULL_FLUSH:mt,Z_FINISH:wt,Z_OK:kt,Z_STREAM_END:yt,Z_DEFAULT_COMPRESSION:vt,Z_DEFAULT_STRATEGY:xt,Z_DEFLATED:zt}=fe;function Lt(e){this.options=dt.assign({level:vt,method:zt,chunkSize:16384,windowBits:15,memLevel:8,strategy:xt},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ft,this.strm.avail_out=0;let i=ot.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==kt)throw new Error(ue[i]);if(t.header&&ot.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?ut.string2buf(t.dictionary):"[object ArrayBuffer]"===gt.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=ot.deflateSetDictionary(this.strm,e),i!==kt)throw new Error(ue[i]);this._dict_set=!0}}Lt.prototype.push=function(e,t){const i=this.strm,s=this.options.chunkSize;let a,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?wt:pt,"string"==typeof e?i.input=ut.string2buf(e):"[object ArrayBuffer]"===gt.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(n===bt||n===mt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(a=ot.deflate(i,n),a===yt)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),a=ot.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===kt;if(0!==i.avail_out){if(n>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},Lt.prototype.onData=function(e){this.chunks.push(e)},Lt.prototype.onEnd=function(e){e===kt&&(this.result=dt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var St=function(e,t){let i,s,a,n,r,l,o,h,d,_,c,u,f,g,p,b,m,w,k,y,v,x,z,L;const S=e.state;i=e.next_in,z=e.input,s=i+(e.avail_in-5),a=e.next_out,L=e.output,n=a-(t-e.avail_out),r=a+(e.avail_out-257),l=S.dmax,o=S.wsize,h=S.whave,d=S.wnext,_=S.window,c=S.hold,u=S.bits,f=S.lencode,g=S.distcode,p=(1<<S.lenbits)-1,b=(1<<S.distbits)-1;e:do{u<15&&(c+=z[i++]<<u,u+=8,c+=z[i++]<<u,u+=8),m=f[c&p];t:for(;;){if(w=m>>>24,c>>>=w,u-=w,w=m>>>16&255,0===w)L[a++]=65535&m;else{if(!(16&w)){if(0==(64&w)){m=f[(65535&m)+(c&(1<<w)-1)];continue t}if(32&w){S.mode=12;break e}e.msg="invalid literal/length code",S.mode=30;break e}k=65535&m,w&=15,w&&(u<w&&(c+=z[i++]<<u,u+=8),k+=c&(1<<w)-1,c>>>=w,u-=w),u<15&&(c+=z[i++]<<u,u+=8,c+=z[i++]<<u,u+=8),m=g[c&b];i:for(;;){if(w=m>>>24,c>>>=w,u-=w,w=m>>>16&255,!(16&w)){if(0==(64&w)){m=g[(65535&m)+(c&(1<<w)-1)];continue i}e.msg="invalid distance code",S.mode=30;break e}if(y=65535&m,w&=15,u<w&&(c+=z[i++]<<u,u+=8,u<w&&(c+=z[i++]<<u,u+=8)),y+=c&(1<<w)-1,y>l){e.msg="invalid distance too far back",S.mode=30;break e}if(c>>>=w,u-=w,w=a-n,y>w){if(w=y-w,w>h&&S.sane){e.msg="invalid distance too far back",S.mode=30;break e}if(v=0,x=_,0===d){if(v+=o-w,w<k){k-=w;do{L[a++]=_[v++]}while(--w);v=a-y,x=L}}else if(d<w){if(v+=o+d-w,w-=d,w<k){k-=w;do{L[a++]=_[v++]}while(--w);if(v=0,d<k){w=d,k-=w;do{L[a++]=_[v++]}while(--w);v=a-y,x=L}}}else if(v+=d-w,w<k){k-=w;do{L[a++]=_[v++]}while(--w);v=a-y,x=L}for(;k>2;)L[a++]=x[v++],L[a++]=x[v++],L[a++]=x[v++],k-=3;k&&(L[a++]=x[v++],k>1&&(L[a++]=x[v++]))}else{v=a-y;do{L[a++]=L[v++],L[a++]=L[v++],L[a++]=L[v++],k-=3}while(k>2);k&&(L[a++]=L[v++],k>1&&(L[a++]=L[v++]))}break}}break}}while(i<s&&a<r);k=u>>3,i-=k,u-=k<<3,c&=(1<<u)-1,e.next_in=i,e.next_out=a,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=a<r?r-a+257:257-(a-r),S.hold=c,S.bits=u},At=15,Tt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Bt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Et=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ct=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),It=(e,t,i,s,a,n,r,l)=>{const o=l.bits;let h,d,_,c,u,f,g=0,p=0,b=0,m=0,w=0,k=0,y=0,v=0,x=0,z=0,L=null,S=0;const A=new Uint16Array(16),T=new Uint16Array(16);let B,E,C,I=null,R=0;for(g=0;g<=At;g++)A[g]=0;for(p=0;p<s;p++)A[t[i+p]]++;for(w=o,m=At;m>=1&&0===A[m];m--);if(w>m&&(w=m),0===m)return a[n++]=20971520,a[n++]=20971520,l.bits=1,0;for(b=1;b<m&&0===A[b];b++);for(w<b&&(w=b),v=1,g=1;g<=At;g++)if(v<<=1,v-=A[g],v<0)return-1;if(v>0&&(0===e||1!==m))return-1;for(T[1]=0,g=1;g<At;g++)T[g+1]=T[g]+A[g];for(p=0;p<s;p++)0!==t[i+p]&&(r[T[t[i+p]]++]=p);if(0===e?(L=I=r,f=19):1===e?(L=Tt,S-=257,I=Bt,R-=257,f=256):(L=Et,I=Ct,f=-1),z=0,p=0,g=b,u=n,k=w,y=0,_=-1,x=1<<w,c=x-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){B=g-y,r[p]<f?(E=0,C=r[p]):r[p]>f?(E=I[R+r[p]],C=L[S+r[p]]):(E=96,C=0),h=1<<g-y,d=1<<k,b=d;do{d-=h,a[u+(z>>y)+d]=B<<24|E<<16|C|0}while(0!==d);for(h=1<<g-1;z&h;)h>>=1;if(0!==h?(z&=h-1,z+=h):z=0,p++,0==--A[g]){if(g===m)break;g=t[i+r[p]]}if(g>w&&(z&c)!==_){for(0===y&&(y=w),u+=b,k=g-y,v=1<<k;k+y<m&&(v-=A[k+y],!(v<=0));)k++,v<<=1;if(x+=1<<k,1===e&&x>852||2===e&&x>592)return 1;_=z&c,a[_]=w<<24|k<<16|u-n|0}}return 0!==z&&(a[u+z]=g-y<<24|64<<16|0),l.bits=w,0},{Z_FINISH:Rt,Z_BLOCK:Mt,Z_TREES:Ft,Z_OK:Nt,Z_STREAM_END:Ut,Z_NEED_DICT:Dt,Z_STREAM_ERROR:Pt,Z_DATA_ERROR:jt,Z_MEM_ERROR:Ot,Z_BUF_ERROR:Ht,Z_DEFLATED:Qt}=fe,Zt=12,Vt=30,Wt=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Gt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Kt,Yt,qt=e=>{if(!e||!e.state)return Pt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Nt},$t=e=>{if(!e||!e.state)return Pt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,qt(e)},Xt=(e,t)=>{let i;if(!e||!e.state)return Pt;const s=e.state;return t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Pt:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,$t(e))},Jt=(e,t)=>{if(!e)return Pt;const i=new Gt;e.state=i,i.window=null;const s=Xt(e,t);return s!==Nt&&(e.state=null),s},ei=!0,ti=e=>{if(ei){Kt=new Int32Array(512),Yt=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(It(1,e.lens,0,288,Kt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;It(2,e.lens,0,32,Yt,0,e.work,{bits:5}),ei=!1}e.lencode=Kt,e.lenbits=9,e.distcode=Yt,e.distbits=5},ii=(e,t,i,s)=>{let a;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),s>=n.wsize?(n.window.set(t.subarray(i-n.wsize,i),0),n.wnext=0,n.whave=n.wsize):(a=n.wsize-n.wnext,a>s&&(a=s),n.window.set(t.subarray(i-s,i-s+a),n.wnext),(s-=a)?(n.window.set(t.subarray(i-s,i),0),n.wnext=s,n.whave=n.wsize):(n.wnext+=a,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=a))),0},si={inflateReset:$t,inflateReset2:Xt,inflateResetKeep:qt,inflateInit:e=>Jt(e,15),inflateInit2:Jt,inflate:(e,t)=>{let i,s,a,n,r,l,o,h,d,_,c,u,f,g,p,b,m,w,k,y,v,x,z=0;const L=new Uint8Array(4);let S,A;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return Pt;i=e.state,i.mode===Zt&&(i.mode=13),r=e.next_out,a=e.output,o=e.avail_out,n=e.next_in,s=e.input,l=e.avail_in,h=i.hold,d=i.bits,_=l,c=o,x=Nt;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;d<16;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if(2&i.wrap&&35615===h){i.check=0,L[0]=255&h,L[1]=h>>>8&255,i.check=ce(i.check,L,2,0),h=0,d=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",i.mode=Vt;break}if((15&h)!==Qt){e.msg="unknown compression method",i.mode=Vt;break}if(h>>>=4,d-=4,v=8+(15&h),0===i.wbits)i.wbits=v;else if(v>i.wbits){e.msg="invalid window size",i.mode=Vt;break}i.dmax=1<<i.wbits,e.adler=i.check=1,i.mode=512&h?10:Zt,h=0,d=0;break;case 2:for(;d<16;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if(i.flags=h,(255&i.flags)!==Qt){e.msg="unknown compression method",i.mode=Vt;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=Vt;break}i.head&&(i.head.text=h>>8&1),512&i.flags&&(L[0]=255&h,L[1]=h>>>8&255,i.check=ce(i.check,L,2,0)),h=0,d=0,i.mode=3;case 3:for(;d<32;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}i.head&&(i.head.time=h),512&i.flags&&(L[0]=255&h,L[1]=h>>>8&255,L[2]=h>>>16&255,L[3]=h>>>24&255,i.check=ce(i.check,L,4,0)),h=0,d=0,i.mode=4;case 4:for(;d<16;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&i.flags&&(L[0]=255&h,L[1]=h>>>8&255,i.check=ce(i.check,L,2,0)),h=0,d=0,i.mode=5;case 5:if(1024&i.flags){for(;d<16;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}i.length=h,i.head&&(i.head.extra_len=h),512&i.flags&&(L[0]=255&h,L[1]=h>>>8&255,i.check=ce(i.check,L,2,0)),h=0,d=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(u=i.length,u>l&&(u=l),u&&(i.head&&(v=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(n,n+u),v)),512&i.flags&&(i.check=ce(i.check,s,u,n)),l-=u,n+=u,i.length-=u),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===l)break e;u=0;do{v=s[n+u++],i.head&&v&&i.length<65536&&(i.head.name+=String.fromCharCode(v))}while(v&&u<l);if(512&i.flags&&(i.check=ce(i.check,s,u,n)),l-=u,n+=u,v)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===l)break e;u=0;do{v=s[n+u++],i.head&&v&&i.length<65536&&(i.head.comment+=String.fromCharCode(v))}while(v&&u<l);if(512&i.flags&&(i.check=ce(i.check,s,u,n)),l-=u,n+=u,v)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;d<16;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if(h!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Vt;break}h=0,d=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Zt;break;case 10:for(;d<32;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}e.adler=i.check=Wt(h),h=0,d=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=r,e.avail_out=o,e.next_in=n,e.avail_in=l,i.hold=h,i.bits=d,Dt;e.adler=i.check=1,i.mode=Zt;case Zt:if(t===Mt||t===Ft)break e;case 13:if(i.last){h>>>=7&d,d-=7&d,i.mode=27;break}for(;d<3;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}switch(i.last=1&h,h>>>=1,d-=1,3&h){case 0:i.mode=14;break;case 1:if(ti(i),i.mode=20,t===Ft){h>>>=2,d-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=Vt}h>>>=2,d-=2;break;case 14:for(h>>>=7&d,d-=7&d;d<32;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Vt;break}if(i.length=65535&h,h=0,d=0,i.mode=15,t===Ft)break e;case 15:i.mode=16;case 16:if(u=i.length,u){if(u>l&&(u=l),u>o&&(u=o),0===u)break e;a.set(s.subarray(n,n+u),r),l-=u,n+=u,o-=u,r+=u,i.length-=u;break}i.mode=Zt;break;case 17:for(;d<14;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if(i.nlen=257+(31&h),h>>>=5,d-=5,i.ndist=1+(31&h),h>>>=5,d-=5,i.ncode=4+(15&h),h>>>=4,d-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Vt;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;d<3;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}i.lens[T[i.have++]]=7&h,h>>>=3,d-=3}for(;i.have<19;)i.lens[T[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,S={bits:i.lenbits},x=It(0,i.lens,0,19,i.lencode,0,i.work,S),i.lenbits=S.bits,x){e.msg="invalid code lengths set",i.mode=Vt;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;z=i.lencode[h&(1<<i.lenbits)-1],p=z>>>24,b=z>>>16&255,m=65535&z,!(p<=d);){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if(m<16)h>>>=p,d-=p,i.lens[i.have++]=m;else{if(16===m){for(A=p+2;d<A;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if(h>>>=p,d-=p,0===i.have){e.msg="invalid bit length repeat",i.mode=Vt;break}v=i.lens[i.have-1],u=3+(3&h),h>>>=2,d-=2}else if(17===m){for(A=p+3;d<A;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}h>>>=p,d-=p,v=0,u=3+(7&h),h>>>=3,d-=3}else{for(A=p+7;d<A;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}h>>>=p,d-=p,v=0,u=11+(127&h),h>>>=7,d-=7}if(i.have+u>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Vt;break}for(;u--;)i.lens[i.have++]=v}}if(i.mode===Vt)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=Vt;break}if(i.lenbits=9,S={bits:i.lenbits},x=It(1,i.lens,0,i.nlen,i.lencode,0,i.work,S),i.lenbits=S.bits,x){e.msg="invalid literal/lengths set",i.mode=Vt;break}if(i.distbits=6,i.distcode=i.distdyn,S={bits:i.distbits},x=It(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,S),i.distbits=S.bits,x){e.msg="invalid distances set",i.mode=Vt;break}if(i.mode=20,t===Ft)break e;case 20:i.mode=21;case 21:if(l>=6&&o>=258){e.next_out=r,e.avail_out=o,e.next_in=n,e.avail_in=l,i.hold=h,i.bits=d,St(e,c),r=e.next_out,a=e.output,o=e.avail_out,n=e.next_in,s=e.input,l=e.avail_in,h=i.hold,d=i.bits,i.mode===Zt&&(i.back=-1);break}for(i.back=0;z=i.lencode[h&(1<<i.lenbits)-1],p=z>>>24,b=z>>>16&255,m=65535&z,!(p<=d);){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if(b&&0==(240&b)){for(w=p,k=b,y=m;z=i.lencode[y+((h&(1<<w+k)-1)>>w)],p=z>>>24,b=z>>>16&255,m=65535&z,!(w+p<=d);){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}h>>>=w,d-=w,i.back+=w}if(h>>>=p,d-=p,i.back+=p,i.length=m,0===b){i.mode=26;break}if(32&b){i.back=-1,i.mode=Zt;break}if(64&b){e.msg="invalid literal/length code",i.mode=Vt;break}i.extra=15&b,i.mode=22;case 22:if(i.extra){for(A=i.extra;d<A;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,d-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;z=i.distcode[h&(1<<i.distbits)-1],p=z>>>24,b=z>>>16&255,m=65535&z,!(p<=d);){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if(0==(240&b)){for(w=p,k=b,y=m;z=i.distcode[y+((h&(1<<w+k)-1)>>w)],p=z>>>24,b=z>>>16&255,m=65535&z,!(w+p<=d);){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}h>>>=w,d-=w,i.back+=w}if(h>>>=p,d-=p,i.back+=p,64&b){e.msg="invalid distance code",i.mode=Vt;break}i.offset=m,i.extra=15&b,i.mode=24;case 24:if(i.extra){for(A=i.extra;d<A;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,d-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Vt;break}i.mode=25;case 25:if(0===o)break e;if(u=c-o,i.offset>u){if(u=i.offset-u,u>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Vt;break}u>i.wnext?(u-=i.wnext,f=i.wsize-u):f=i.wnext-u,u>i.length&&(u=i.length),g=i.window}else g=a,f=r-i.offset,u=i.length;u>o&&(u=o),o-=u,i.length-=u;do{a[r++]=g[f++]}while(--u);0===i.length&&(i.mode=21);break;case 26:if(0===o)break e;a[r++]=i.length,o--,i.mode=21;break;case 27:if(i.wrap){for(;d<32;){if(0===l)break e;l--,h|=s[n++]<<d,d+=8}if(c-=o,e.total_out+=c,i.total+=c,c&&(e.adler=i.check=i.flags?ce(i.check,a,c,r-c):de(i.check,a,c,r-c)),c=o,(i.flags?h:Wt(h))!==i.check){e.msg="incorrect data check",i.mode=Vt;break}h=0,d=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;d<32;){if(0===l)break e;l--,h+=s[n++]<<d,d+=8}if(h!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Vt;break}h=0,d=0}i.mode=29;case 29:x=Ut;break e;case Vt:x=jt;break e;case 31:return Ot;default:return Pt}return e.next_out=r,e.avail_out=o,e.next_in=n,e.avail_in=l,i.hold=h,i.bits=d,(i.wsize||c!==e.avail_out&&i.mode<Vt&&(i.mode<27||t!==Rt))&&ii(e,e.output,e.next_out,c-e.avail_out),_-=e.avail_in,c-=e.avail_out,e.total_in+=_,e.total_out+=c,i.total+=c,i.wrap&&c&&(e.adler=i.check=i.flags?ce(i.check,a,c,e.next_out-c):de(i.check,a,c,e.next_out-c)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Zt?128:0)+(20===i.mode||15===i.mode?256:0),(0===_&&0===c||t===Rt)&&x===Nt&&(x=Ht),x},inflateEnd:e=>{if(!e||!e.state)return Pt;let t=e.state;return t.window&&(t.window=null),e.state=null,Nt},inflateGetHeader:(e,t)=>{if(!e||!e.state)return Pt;const i=e.state;return 0==(2&i.wrap)?Pt:(i.head=t,t.done=!1,Nt)},inflateSetDictionary:(e,t)=>{const i=t.length;let s,a,n;return e&&e.state?(s=e.state,0!==s.wrap&&11!==s.mode?Pt:11===s.mode&&(a=1,a=de(a,t,i,0),a!==s.check)?jt:(n=ii(e,t,i,i),n?(s.mode=31,Ot):(s.havedict=1,Nt))):Pt},inflateInfo:"pako inflate (from Nodeca project)"};var ai=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},ni=Object.prototype.toString,{Z_NO_FLUSH:ri,Z_FINISH:li,Z_OK:oi,Z_STREAM_END:hi,Z_NEED_DICT:di,Z_STREAM_ERROR:_i,Z_DATA_ERROR:ci,Z_MEM_ERROR:ui}=fe;function fi(e){this.options=dt.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ft,this.strm.avail_out=0;let i=si.inflateInit2(this.strm,t.windowBits);if(i!==oi)throw new Error(ue[i]);if(this.header=new ai,si.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=ut.string2buf(t.dictionary):"[object ArrayBuffer]"===ni.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=si.inflateSetDictionary(this.strm,t.dictionary),i!==oi)))throw new Error(ue[i])}function gi(e,t){const i=new fi(t);if(i.push(e),i.err)throw i.msg||ue[i.err];return i.result}fi.prototype.push=function(e,t){const i=this.strm,s=this.options.chunkSize,a=this.options.dictionary;let n,r,l;if(this.ended)return!1;for(r=t===~~t?t:!0===t?li:ri,"[object ArrayBuffer]"===ni.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),n=si.inflate(i,r),n===di&&a&&(n=si.inflateSetDictionary(i,a),n===oi?n=si.inflate(i,r):n===ci&&(n=di));i.avail_in>0&&n===hi&&i.state.wrap>0&&0!==e[i.next_in];)si.inflateReset(i),n=si.inflate(i,r);switch(n){case _i:case ci:case di:case ui:return this.onEnd(n),this.ended=!0,!1}if(l=i.avail_out,i.next_out&&(0===i.avail_out||n===hi))if("string"===this.options.to){let e=ut.utf8border(i.output,i.next_out),t=i.next_out-e,a=ut.buf2string(i.output,e);i.next_out=t,i.avail_out=s-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(a)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(n!==oi||0!==l){if(n===hi)return n=si.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},fi.prototype.onData=function(e){this.chunks.push(e)},fi.prototype.onEnd=function(e){e===oi&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=dt.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var pi={Inflate:fi,inflate:gi,inflateRaw:function(e,t){return(t=t||{}).raw=!0,gi(e,t)},ungzip:gi,constants:fe},{Inflate:bi,inflate:mi,inflateRaw:wi,ungzip:ki}=pi,yi=mi;var vi=new Map([[1,function(e,t){let i=new Uint8Array(e);return yi(i).buffer}],[2,function(e,t){let i=e.byteLength,s=new Uint8Array(i),a=Math.floor(i/t),n=new DataView(e);for(var r=0;r<t;r++)for(var l=0;l<a;l++)s[r+l*t]=n.getUint8(r*a+l);return s.buffer}],[3,function(e,t){return function(e){for(var t=e.byteLength%2!=0,i=e.byteLength-4,s=new DataView(e),a=0,n=0,r=0;r<i-1;r+=2){n=(n+(a=(a+s.getUint16(r,!0))%65535))%65535}if(t){n=(n+(a=(a+s.getUint8(i-1))%65535))%65535}var[l,o]=h.unpack_from(">HH",e,i);if(o%=65535,a!=(l%=65535)||n!=o)throw'ValueError("fletcher32 checksum invalid")'}(e),e.slice(0,-4)}]]),xi=class{constructor(e,t){this.fh=e,this.offset=t,this.depth=null}init(){this.all_nodes=new Map,this._read_root_node(),this._read_children()}_read_children(){let e=this.depth;for(;e>0;){for(var t of this.all_nodes.get(e))for(var i of t.get("addresses"))this._add_node(this._read_node(i,e-1));e--}}_read_root_node(){let e=this._read_node(this.offset,null);this._add_node(e),this.depth=e.get("node_level")}_add_node(e){let t=e.get("node_level");this.all_nodes.has(t)?this.all_nodes.get(t).push(e):this.all_nodes.set(t,[e])}_read_node(e,t){let i=this._read_node_header(e,t);return i.set("keys",[]),i.set("addresses",[]),i}_read_node_header(e){throw"NotImplementedError: must define _read_node_header in implementation class"}},zi=class extends xi{constructor(){super(...arguments),t(this,"B_LINK_NODE",new Map([["signature","4s"],["node_type","B"],["node_level","B"],["entries_used","H"],["left_sibling","Q"],["right_sibling","Q"]]))}_read_node_header(e,t){let i=s(this.B_LINK_NODE,this.fh,e);if(null!=t&&i.get("node_level")!=t)throw"node level does not match";return i}},Li=class extends zi{constructor(e,i){super(e,i),t(this,"NODE_TYPE",0),this.init()}_read_node(e,t){let i=this._read_node_header(e,t);e+=n(this.B_LINK_NODE);let s=[],a=[],r=i.get("entries_used");for(var l=0;l<r;l++){let t=h.unpack_from("<Q",this.fh,e)[0];e+=8;let i=h.unpack_from("<Q",this.fh,e)[0];e+=8,s.push(t),a.push(i)}return s.push(h.unpack_from("<Q",this.fh,e)[0]),i.set("keys",s),i.set("addresses",a),i}symbol_table_addresses(){var e=[],t=this.all_nodes.get(0);for(var i of t)e=e.concat(i.get("addresses"));return e}},Si=class extends zi{constructor(e,i,s){super(e,i),t(this,"NODE_TYPE",1),this.dims=s,this.init()}_read_node(e,t){let i=this._read_node_header(e,t);e+=n(this.B_LINK_NODE);var s=[],a=[];let r=i.get("entries_used");for(var l=0;l<r;l++){let[t,i]=h.unpack_from("<II",this.fh,e);e+=8;let n="<"+this.dims.toFixed()+"Q",r=h.calcsize(n),l=h.unpack_from(n,this.fh,e);e+=r;let o=h.unpack_from("<Q",this.fh,e)[0];e+=8,s.push(new Map([["chunk_size",t],["filter_mask",i],["chunk_offset",l]])),a.push(o)}return i.set("keys",s),i.set("addresses",a),i}construct_data_from_chunks(e,t,i,s){var a,n,r;if(i instanceof Array){i;let e=i[0];if("REFERENCE"==e){if(8!=i[1])throw"NotImplementedError('Unsupported Reference type')";i="<u8";a="getUint64",n=!1,r=8}else{if("VLEN_STRING"!=e&&"VLEN_SEQUENCE"!=e)throw"NotImplementedError('datatype not implemented')";a="getVLENStruct",n=!1,r=16}}else null,[a,n,r]=o(i);var l=t.reduce((function(e,t){return e*t}),1),h=e.reduce((function(e,t){return e*t}),1);let _=t.length;var c=1,u=(e.slice().map((function(e){let t=c;return c*=e,t})),c=1,t.slice().reverse().map((function(e){let t=c;return c*=e,t})).reverse()),f=new Array(l);let g=h*r;for(var p of this.all_nodes.get(0)){let i=p.get("keys"),l=p.get("addresses"),o=i.length;for(var b=0;b<o;b++){let o=i[b],c=l[b];var m;if(null==s)m=this.fh.slice(c,c+g);else{m=this.fh.slice(c,c+o.get("chunk_size"));let e=o.get("filter_mask");m=this._filter_chunk(m,e,s,r)}for(var w=o.get("chunk_offset").slice(),k=w.slice(),y=k.map((function(){return 0})),v=new d(m),x=0;x<h;x++){for(var z=_-1;z>=0&&y[z]>=e[z];z--)y[z]=0,k[z]=w[z],z>0&&(y[z-1]+=1,k[z-1]+=1);if(k.slice(0,-1).every((function(e,i){return e<t[i]}))){let e=x*r,t=v[a](e,!n,r);f[k.slice(0,-1).reduce((function(e,t,i){return t*u[i]+e}),0)]=t}y[_-1]+=1,k[_-1]+=1}}}return f}_filter_chunk(e,t,i,s){let a=i.length,n=e.slice();for(var r=a-1;r>=0;r--){if(t&1<<r)continue;let e=i[r],a=e.get("filter_id"),l=e.get("client_data");if(!vi.has(a))throw'NotImplementedError("Filter with id:'+a.toFixed()+' not supported")';n=vi.get(a)(n,s,l)}return n}},Ai=class extends xi{constructor(e,i){super(e,i),t(this,"B_TREE_HEADER",new Map([["signature","4s"],["version","B"],["node_type","B"],["node_size","I"],["record_size","H"],["depth","H"],["split_percent","B"],["merge_percent","B"],["root_address","Q"],["root_nrecords","H"],["total_nrecords","Q"]])),t(this,"B_LINK_NODE",new Map([["signature","4s"],["version","B"],["node_type","B"]])),this.init()}_read_root_node(){let e=this._read_tree_header(this.offset);this.address_formats=this._calculate_address_formats(e),this.header=e,this.depth=e.get("depth");let t=[e.get("root_address"),e.get("root_nrecords"),e.get("total_nrecords")],i=this._read_node(t,this.depth);this._add_node(i)}_read_tree_header(e){return s(this.B_TREE_HEADER,this.fh,this.offset)}_calculate_address_formats(e){let t=e.get("node_size"),i=e.get("record_size"),s=0,a=0,n=new Map,r=e.get("depth");for(var l=0;l<=r;l++){let e,o,h,d="",_="",c="";if(0==l?(e=0,o=0,h=0):1==l?(e=8,d="<Q",o=this._required_bytes(s),_=this._int_format(o),h=0):(e=8,d="<Q",o=this._required_bytes(s),_=this._int_format(o),h=this._required_bytes(a),c=this._int_format(h)),n.set(l,[e,o,h,d,_,c]),l<r){let n=e+o+h;s=this._nrecords_max(t,i,n),a>0?a*=s:a=s}}return n}_nrecords_max(e,t,i){return Math.floor((e-10-i)/(t+i))}_required_bytes(e){return Math.ceil(_(e)/8)}_int_format(e){return["<B","<H","<I","<Q"][e-1]}_read_node(e,t){let[i,s,a]=e,r=this._read_node_header(i,t);i+=n(this.B_LINK_NODE);let l=this.header.get("record_size"),o=[];for(let e=0;e<s;e++){let e=this._parse_record(this.fh,i,l);i+=l,o.push(e)}let d=[],_=this.address_formats.get(t);if(0!=t){let[e,t,a,n,r,l]=_;for(let o=0;o<=s;o++){let s=h.unpack_from(n,this.fh,i)[0];i+=e;let o=h.unpack_from(r,this.fh,i)[0];i+=t;let _=o;a>0&&(_=h.unpack_from(l,this.fh,i)[0]),d.push([s,o,_])}}return r.set("keys",o),r.set("addresses",d),r}_read_node_header(e,t){let i=s(this.B_LINK_NODE,this.fh,e);return i.set("node_level",t),i}*iter_records(){for(let e of this.all_nodes.values())for(let t of e)for(let e of t.get("keys"))yield e}_parse_record(e){throw"NotImplementedError"}},Ti=class extends Ai{constructor(){super(...arguments),t(this,"NODE_TYPE",5)}_parse_record(e,t,i){let s=h.unpack_from("<I",e,t)[0];return t+=4,new Map([["namehash",s],["heapid",e.slice(t,t+7)]])}},Bi=class extends Ai{constructor(){super(...arguments),t(this,"NODE_TYPE",6)}_parse_record(e,t,i){let s=h.unpack_from("<Q",e,t)[0];return t+=8,new Map([["creationorder",s],["heapid",e.slice(t,t+7)]])}},Ei=class{constructor(e,t){let i=h.unpack_from("<B",e,t+8);var a;if(0==i)a=s(Ui,e,t),this._end_of_sblock=t+Di;else{if(2!=i&&3!=i)throw"unsupported superblock version: "+i.toFixed();a=s(Pi,e,t),this._end_of_sblock=t+ji}if(a.get("format_signature")!=Fi)throw"Incorrect file signature: "+a.get("format_signature");if(8!=a.get("offset_size")||8!=a.get("length_size"))throw"File uses non-64-bit addressing";this.version=a.get("superblock_version"),this._contents=a,this._root_symbol_table=null,this._fh=e}get offset_to_dataobjects(){if(0==this.version){var e=new Ii(this._fh,this._end_of_sblock,!0);return this._root_symbol_table=e,e.group_offset}if(2==this.version||3==this.version)return this._contents.get("root_group_address");throw"Not implemented version = "+this.version.toFixed()}},Ci=class{constructor(e,t){let i=s(Vi,e,t);a("HEAP"==i.get("signature")),a(0==i.get("version"));let n=i.get("address_of_data_segment"),r=e.slice(n,n+i.get("data_segment_size"));i.set("heap_data",r),this._contents=i,this.data=r}get_object_name(e){let t=new Uint8Array(this.data).indexOf(0,e)-e;return h.unpack_from("<"+t.toFixed()+"s",this.data,e)[0]}},Ii=class{constructor(e,t,i=!1){var a;if(i)a=new Map([["symbols",1]]);else{if("SNOD"!=(a=s(Qi,e,t)).get("signature"))throw"incorrect node type";t+=Zi}for(var n=[],r=a.get("symbols"),l=0;l<r;l++)n.push(s(Oi,e,t)),t+=Hi;i&&(this.group_offset=n[0].get("object_header_address")),this.entries=n,this._contents=a}assign_name(e){this.entries.forEach((function(t){let i=t.get("link_name_offset"),s=e.get_object_name(i);t.set("link_name",s)}))}get_links(e){var t={};return this.entries.forEach((function(i){let s=i.get("cache_type"),a=i.get("link_name");if(0==s||1==s)t[a]=i.get("object_header_address");else if(2==s){let s=i.get("scratch"),r=new ArrayBuffer(4),l=new Uint8Array(r);for(var n=0;n<4;n++)l[n]=s.charCodeAt(n);let o=h.unpack_from("<I",r,0)[0];t[a]=e.get_object_name(o)}})),t}},Ri=class{constructor(e,t){let i=s(Wi,e,t);t+=Gi;let a=i.get("collection_size")-Gi,n=e.slice(t,t+a);this.heap_data=n,this._header=i,this._objects=null}get objects(){if(null==this._objects){this._objects=new Map;for(var e=0;e<=this.heap_data.byteLength-Yi;){let t=s(Ki,this.heap_data,e);if(0==t.get("object_index"))break;e+=Yi;let i=this.heap_data.slice(e,e+t.get("object_size"));this._objects.set(t.get("object_index"),i),e+=r(t.get("object_size"))}}return this._objects}},Mi=class{constructor(e,t){this.fh=e;let i=s(qi,e,t);if(t+=n(qi),a("FRHP"==i.get("signature")),a(0==i.get("version")),i.get("filter_info_size")>0)throw"Filter info size not supported on FractalHeap";if(i.get("btree_address_huge_objects")!=Ni)throw"Huge objects not implemented in FractalHeap";i.set("btree_address_huge_objects",null),i.get("root_block_address")==Ni&&i.set("root_block_address",null);let r=i.get("log2_maximum_heap_size"),l=this._min_size_nbits(r),o=new Map([["signature","4s"],["version","B"],["heap_header_adddress","Q"],["block_offset",`${l}B`]]);this.indirect_block_header=new Map(o),this.indirect_block_header_size=n(o),2==(2&i.get("flags"))&&o.set("checksum","I"),this.direct_block_header=o,this.direct_block_header_size=n(o);let h=i.get("maximum_direct_block_size");this._managed_object_offset_size=this._min_size_nbits(r);let d=Math.min(h,i.get("max_managed_object_size"));this._managed_object_length_size=this._min_size_integer(d);let _=i.get("starting_block_size"),c=i.get("table_width");if(!(_>0))throw"Starting block size == 0 not implemented";let u=Number(Math.floor(Math.log2(h)));a(1n<<BigInt(u)==h);let f=Number(Math.floor(Math.log2(_)));a(1n<<BigInt(f)==_),this._max_direct_nrows=u-f+2;let g=Math.floor(Math.log2(c));a(1<<g==c),this._indirect_nrows_sub=g+f-1,this.header=i,this.nobjects=i.get("managed_object_count")+i.get("huge_object_count")+i.get("tiny_object_count");let p=[],b=i.get("root_block_address"),m=0;if(null!=b&&(m=i.get("indirect_current_rows_count")),m>0)for(let t of this._iter_indirect_block(e,b,m))p.push(t);else{let t=this._read_direct_block(e,b,_);p.push(t)}let w=p.reduce(((e,t)=>e+t.byteLength),0),k=new Uint8Array(w),y=0;p.forEach((e=>{k.set(new Uint8Array(e),y),y+=e.byteLength})),this.managed=k.buffer}_read_direct_block(e,t,i){let n=e.slice(t,t+i);return a("FHDB"==s(this.direct_block_header,n).get("signature")),n}get_data(e){let t=h.unpack_from("<B",e,0)[0],i=t>>4&3,s=1;if(0==i){a(0==t>>6);let i=this._managed_object_offset_size,n=c(i,e,s);s+=i,i=this._managed_object_length_size;let r=c(i,e,s);return this.managed.slice(n,n+r)}throw 1==i?"tiny objectID not supported in FractalHeap":2==i?"huge objectID not supported in FractalHeap":"unknown objectID type in FractalHeap"}_min_size_integer(e){return this._min_size_nbits(_(e))}_min_size_nbits(e){return Math.ceil(e/8)}*_iter_indirect_block(e,t,i){let n=s(this.indirect_block_header,e,t);t+=this.indirect_block_header_size,a("FHIB"==n.get("signature"));let r=n.get("block_offset").reduce(((e,t,i)=>e+(t<<8*i)),0);n.set("block_offset",r);let[l,o]=this._indirect_info(i),d=[];for(let i=0;i<l;i++){let s=h.unpack_from("<Q",e,t)[0];if(t+=8,s==Ni)break;let a=this._calc_block_size(i);d.push([s,a])}let _=[];for(let i=l;i<l+o;i++){let s=h.unpack_from("<Q",e,t)[0];if(t+=8,s==Ni)break;let a=this._calc_block_size(i),n=this._iblock_nrows_from_block_size(a);_.push([s,n])}for(let[t,i]of d){let s=this._read_direct_block(e,t,i);yield s}for(let[t,i]of _)for(let s of this._iter_indirect_block(e,t,i))yield s}_calc_block_size(e){let t=Math.floor(e/this.header.get("table_width"));return 2**Math.max(t-1,0)*this.header.get("starting_block_size")}_iblock_nrows_from_block_size(e){let t=Math.floor(Math.log2(e));return a(2**t==e),t-this._indirect_nrows_sub}_indirect_info(e){let t,i,s=this.header.get("table_width"),a=e*s,n=this._max_direct_nrows*s;return e<=n?(t=a,i=0):(t=n,i=a-n),[t,i]}_int_format(e){return["B","H","I","Q"][e-1]}},Fi=h.unpack_from("8s",new Uint8Array([137,72,68,70,13,10,26,10]).buffer)[0],Ni=h.unpack_from("<Q",new Uint8Array([255,255,255,255,255,255,255,255]).buffer)[0],Ui=new Map([["format_signature","8s"],["superblock_version","B"],["free_storage_version","B"],["root_group_version","B"],["reserved_0","B"],["shared_header_version","B"],["offset_size","B"],["length_size","B"],["reserved_1","B"],["group_leaf_node_k","H"],["group_internal_node_k","H"],["file_consistency_flags","L"],["base_address_lower","Q"],["free_space_address","Q"],["end_of_file_address","Q"],["driver_information_address","Q"]]),Di=n(Ui),Pi=new Map([["format_signature","8s"],["superblock_version","B"],["offset_size","B"],["length_size","B"],["file_consistency_flags","B"],["base_address","Q"],["superblock_extension_address","Q"],["end_of_file_address","Q"],["root_group_address","Q"],["superblock_checksum","I"]]),ji=n(Pi),Oi=new Map([["link_name_offset","Q"],["object_header_address","Q"],["cache_type","I"],["reserved","I"],["scratch","16s"]]),Hi=n(Oi),Qi=new Map([["signature","4s"],["version","B"],["reserved_0","B"],["symbols","H"]]),Zi=n(Qi),Vi=new Map([["signature","4s"],["version","B"],["reserved","3s"],["data_segment_size","Q"],["offset_to_free_list","Q"],["address_of_data_segment","Q"]]),Wi=new Map([["signature","4s"],["version","B"],["reserved","3s"],["collection_size","Q"]]),Gi=n(Wi),Ki=new Map([["object_index","H"],["reference_count","H"],["reserved","I"],["object_size","Q"]]),Yi=n(Ki),qi=new Map([["signature","4s"],["version","B"],["object_index_size","H"],["filter_info_size","H"],["flags","B"],["max_managed_object_size","I"],["next_huge_object_index","Q"],["btree_address_huge_objects","Q"],["managed_freespace_size","Q"],["freespace_manager_address","Q"],["managed_space_size","Q"],["managed_alloc_size","Q"],["next_directblock_iterator_address","Q"],["managed_object_count","Q"],["huge_objects_total_size","Q"],["huge_object_count","Q"],["tiny_objects_total_size","Q"],["tiny_object_count","Q"],["table_width","H"],["starting_block_size","Q"],["maximum_direct_block_size","Q"],["log2_maximum_heap_size","H"],["indirect_starting_rows_count","H"],["root_block_address","Q"],["indirect_current_rows_count","H"]]),$i=class{constructor(e,t){let i=h.unpack_from("<B",e,t)[0];if(1==i)var[s,a,n]=this._parse_v1_objects(e,t);else{if(i!="O".charCodeAt(0))throw"InvalidHDF5File('unknown Data Object Header')";var[s,a,n]=this._parse_v2_objects(e,t)}this.fh=e,this.msgs=s,this.msg_data=a,this.offset=t,this._global_heaps={},this._header=n,this._filter_pipeline=null,this._chunk_params_set=!1,this._chunks=null,this._chunk_dims=null,this._chunk_address=null}get dtype(){let e=this.find_msg_type(Ls)[0].get("offset_to_message");return new u(this.fh,e).dtype}get chunks(){return this._get_chunk_params(),this._chunks}get shape(){let e=this.find_msg_type(xs)[0].get("offset_to_message");return function(e,t){let i=h.unpack_from("<B",e,t)[0];var n;if(1==i)a(1==(n=s(rs,e,t)).get("version")),t+=ls;else{if(2!=i)throw"InvalidHDF5File('unknown dataspace message version')";a(2==(n=s(os,e,t)).get("version")),t+=hs}let r=n.get("dimensionality");return h.unpack_from("<"+(2*r).toFixed()+"I",e,t).filter((function(e,t){return t%2==0}))}(this.fh,e)}get filter_pipeline(){if(null!=this._filter_pipeline)return this._filter_pipeline;let e=this.find_msg_type(Bs);if(!e.length)return this._filter_pipeline=null,this._filter_pipeline;var t=e[0].get("offset_to_message");let[i,a]=h.unpack_from("<BB",this.fh,t);t+=h.calcsize("<BB");var n=[];if(1==i){let[e,i]=h.unpack_from("<HI",this.fh,t);t+=h.calcsize("<HI");for(var l=0;l<a;l++){let e=s(ys,this.fh,t);t+=vs;let i=r(e.get("name_length"),8),a="<"+i.toFixed()+"s",l=h.unpack_from(a,this.fh,t)[0];e.set("filter_name",l),t+=i,a="<"+e.get("client_data_values").toFixed()+"I";let o=h.unpack_from(a,this.fh,t);e.set("client_data",o),t+=4*e.get("client_data_values"),e.get("client_data_values")%2&&(t+=4),n.push(e)}}else{if(2!=i)throw`version ${i} is not supported`;for(let e=0;e<a;e++){let e=new Map,i=this.fh,s=h.unpack_from("<H",i,t)[0];t+=2,e.set("filter_id",s);let a=0;s>255&&(a=h.unpack_from("<H",i,t)[0],t+=2);let r=h.unpack_from("<H",i,t)[0];t+=2;let l=(1&r)>0;e.set("optional",l);let o,d=h.unpack_from("<H",i,t)[0];t+=2,a>0&&(o=h.unpack_from(`${a}s`,i,t)[0],t+=a),e.set("name",o);let _=h.unpack_from(`<${d}i`,i,t);t+=4*d,e.set("client_data_values",_),n.push(e)}}return this._filter_pipeline=n,this._filter_pipeline}find_msg_type(e){return this.msgs.filter((function(t){return t.get("type")==e}))}get_attributes(){let e={},t=this.find_msg_type(Es);for(let i of t){let t=i.get("offset_to_message"),[s,a]=this.unpack_attribute(t);e[s]=a}return e}get fillvalue(){var e,t=this.find_msg_type(Ss)[0].get("offset_to_message");let i=h.unpack_from("<B",this.fh,t)[0];var a,n,r;if(1==i||2==i)a=s(bs,this.fh,t),t+=ms,e=a.get("fillvalue_defined");else{if(3!=i)throw'InvalidHDF5File("Unknown fillvalue msg version: "'+String(i);a=s(ws,this.fh,t),t+=ks,e=32&a.get("flags")}if(e?(n=h.unpack_from("<I",this.fh,t)[0],t+=4):n=0,n){let[e,i,s]=o(this.dtype);r=new d(this.fh)[e](t,!i,s)}else r=0;return r}unpack_attribute(e){let t=h.unpack_from("<B",this.fh,e)[0];var i,n;if(1==t)a(1==(i=s(es,this.fh,e)).get("version")),e+=ts,n=8;else{if(3!=t)throw"unsupported attribute message version: "+t;a(3==(i=s(is,this.fh,e)).get("version")),e+=ss,n=1}let l=i.get("name_size"),o=h.unpack_from("<"+l.toFixed()+"s",this.fh,e)[0];var d;o=o.replace(/\x00$/,""),e+=r(l,n);try{d=new u(this.fh,e).dtype}catch(e){return console.log("Attribute "+o+" type not implemented, set to null."),[o,null]}e+=r(i.get("datatype_size"),n);let _=this.determine_data_shape(this.fh,e),c=_.reduce((function(e,t){return e*t}),1);e+=r(i.get("dataspace_size"),n);var f=this._attr_value(d,this.fh,c,e);return 0==_.length&&(f=f[0]),[o,f]}determine_data_shape(e,t){let i=h.unpack_from("<B",e,t)[0];var n;if(1==i)a(1==(n=s(rs,e,t)).get("version")),t+=ls;else{if(2!=i)throw"unknown dataspace message version";a(2==(n=s(os,e,t)).get("version")),t+=hs}let r=n.get("dimensionality");return h.unpack_from("<"+r.toFixed()+"Q",e,t)}_attr_value(e,t,i,s){var a=new Array(i);if(e instanceof Array){let o=e[0];for(var n=0;n<i;n++)if("VLEN_STRING"==o){let i=e[2];var[r,l]=this._vlen_size_and_data(t,s);const o=new TextDecoder(0==i?"ascii":"utf-8");a[n]=o.decode(l),s+=16}else if("REFERENCE"==o){var _=h.unpack_from("<Q",t,s);a[n]=_,s+=8}else{if("VLEN_SEQUENCE"!=o)throw"NotImplementedError";{let i=e[1];var[r,l]=this._vlen_size_and_data(t,s);a[n]=this._attr_value(i,l,r,0),s+=16}}}else{let[r,l,h]=o(e),_=new d(t,0);for(n=0;n<i;n++)a[n]=_[r](s,!l,h),s+=h}return a}_vlen_size_and_data(e,t){let i=h.unpack_from("<I",e,t)[0],n=s(Ji,e,t+4),r=n.get("collection_address");var l;return a(n.get("collection_address")<Number.MAX_SAFE_INTEGER),r in this._global_heaps||(l=new Ri(this.fh,r),this._global_heaps[r]=l),[i,(l=this._global_heaps[r]).objects.get(n.get("object_index"))]}_parse_v1_objects(e,t){let i=s(as,e,t);a(1==i.get("version"));let r=i.get("total_header_messages");for(var l=i.get("object_header_size"),o=t+n(as),d=e.slice(o,o+l),_=[[o,l]],c=0,u=0,f=new Array(r),g=0;g<r;g++){u>=l&&([o,l]=_[++c],u=0);let t=s(ds,e,o+u),i=o+u+_s;if(t.set("offset_to_message",i),t.get("type")==Cs){var[p,b]=h.unpack_from("<QQ",e,i);_.push([p,b])}u+=_s+t.get("size"),f[g]=t}return[f,d,i]}_parse_v2_objects(e,t){var[i,a,n]=this._parse_v2_header(e,t);t=n;for(var r=[],l=i.get("size_of_chunk_0"),o=e.slice(t,t+=l),d=[[n,l]],_=0,c=0;;){if(c>=l-us){let e=d[++_];if(null==e)break;[n,l]=e,c=0}let t=s(cs,e,n+c),i=n+c+us+a;if(t.set("offset_to_message",i),t.get("type")==Cs){var[u,f]=h.unpack_from("<QQ",e,i);d.push([u+4,f-4])}c+=us+t.get("size")+a,r.push(t)}return[r,o,i]}_parse_v2_header(e,t){let i=s(ns,e,t);var r;if(t+=n(ns),a(2==i.get("version")),r=4&i.get("flags")?2:0,a(0==(16&i.get("flags"))),32&i.get("flags")){let s=h.unpack_from("<4I",e,t);t+=16,i.set("access_time",s[0]),i.set("modification_time",s[1]),i.set("change_time",s[2]),i.set("birth_time",s[3])}let l=["<B","<H","<I","<Q"][3&i.get("flags")];return i.set("size_of_chunk_0",h.unpack_from(l,e,t)[0]),[i,r,t+=h.calcsize(l)]}get_links(){return Object.fromEntries(this.iter_links())}*iter_links(){for(let e of this.msgs)e.get("type")==Is?yield*this._iter_links_from_symbol_tables(e):e.get("type")==As?yield this._get_link_from_link_msg(e):e.get("type")==zs&&(yield*this._iter_link_from_link_info_msg(e))}*_iter_links_from_symbol_tables(e){a(16==e.get("size"));let t=s(fs,this.fh,e.get("offset_to_message"));yield*this._iter_links_btree_v1(t.get("btree_address"),t.get("heap_address"))}*_iter_links_btree_v1(e,t){let i=new Li(this.fh,e),s=new Ci(this.fh,t);for(let e of i.symbol_table_addresses()){let t=new Ii(this.fh,e);t.assign_name(s),yield*Object.entries(t.get_links(s))}}_get_link_from_link_msg(e){let t=e.get("offset_to_message");return this._decode_link_msg(this.fh,t)[1]}_decode_link_msg(e,t){let[i,s]=h.unpack_from("<BB",e,t);t+=2,a(1==i);let n,r,l=2**(3&s),o=(16&s)>0,d=(4&s)>0;(8&s)>0?(n=h.unpack_from("<B",e,t)[0],t+=1):n=0,a([0,1].includes(n)),d&&(r=h.unpack_from("<Q",e,t)[0],t+=8);let _=0;o&&(_=h.unpack_from("<B",e,t)[0],t+=1);let c=0==_?"ascii":"utf-8",u=["<B","<H","<I","<Q"][3&s],f=h.unpack_from(u,e,t)[0];t+=l;let g,p=new TextDecoder(c).decode(e.slice(t,t+f));if(t+=f,0==n)g=h.unpack_from("<Q",e,t)[0];else if(1==n){let i=h.unpack_from("<H",e,t)[0];t+=2,g=new TextDecoder(c).decode(e.slice(t,t+i))}return[r,[p,g]]}*_iter_link_from_link_info_msg(e){let t=e.get("offset_to_message"),i=this._decode_link_info_msg(this.fh,t),s=i.get("heap_address"),a=i.get("name_btree_address"),n=i.get("order_btree_address");null!=a&&(yield*this._iter_links_btree_v2(a,n,s))}*_iter_links_btree_v2(e,t,i){let s,a=new Mi(this.fh,i);s=t!=Xi?new Bi(this.fh,t):new Ti(this.fh,e);let n=new Map;for(let e of s.iter_records()){let t=a.get_data(e.get("heapid")),[i,s]=this._decode_link_msg(t,0);n.set(i,s)}let r=Array.from(n.keys()).sort();for(let e of r)yield n.get(e)}_decode_link_info_msg(e,t){let[i,n]=h.unpack_from("<BB",e,t);a(0==i),t+=2,(1&n)>0&&(t+=8);let r=s((2&n)>0?ps:gs,e,t),l=new Map;for(let[e,t]of r.entries())l.set(e,t==Xi?null:t);return l}get is_dataset(){return this.find_msg_type(xs).length>0}get_data(){let e=this.find_msg_type(Ts)[0].get("offset_to_message");var[t,i,s,a]=this._get_data_message_properties(e);if(0==s)throw"Compact storage of DataObject not implemented";return 1==s?this._get_contiguous_data(a):2==s?this._get_chunked_data(e):void 0}_get_data_message_properties(e){let t,i,s,[n,r,l]=h.unpack_from("<BBB",this.fh,e);return 1==n||2==n?(t=r,i=l,s=e,s+=h.calcsize("<BBB"),s+=h.calcsize("<BI"),a(1==i||2==i)):3!=n&&4!=n||(i=r,s=e,s+=h.calcsize("<BB")),a(n>=1&&n<=4),[n,t,i,s]}_get_contiguous_data(e){let[t]=h.unpack_from("<Q",this.fh,e);if(t==Xi){let e=this.shape.reduce((function(e,t){return e*t}),1);return new Array(e)}var i=this.shape.reduce((function(e,t){return e*t}),1);if(this.dtype instanceof Array){let e=this.dtype[0];if("REFERENCE"==e){if(8!=this.dtype[1])throw"NotImplementedError('Unsupported Reference type')";return this.fh.slice(t,t+i)}if("VLEN_STRING"==e){let e=this.dtype[2];const n=new TextDecoder(0==e?"ascii":"utf-8");var s=[];for(a=0;a<i;a++){const[e,i]=this._vlen_size_and_data(this.fh,t);s[a]=n.decode(i),t+=16}return s}throw"NotImplementedError('datatype not implemented')"}{let e=this.dtype;if(/[<>=!@\|]?(i|u|f|S)(\d*)/.test(e)){let[s,n,r]=o(e),l=new Array(i),h=new d(this.fh);for(var a=0;a<i;a++)l[a]=h[s](t+a*r,!n,r);return l}throw"not Implemented - no proper dtype defined"}}_get_chunked_data(e){this._get_chunk_params();let t=new Si(this.fh,this._chunk_address,this._chunk_dims).construct_data_from_chunks(this.chunks,this.shape,this.dtype,this.filter_pipeline);if(this.dtype instanceof Array&&/^VLEN/.test(this.dtype[0])){let e=this.dtype[0];for(var i=0;i<t.length;i++){let[a,n,r]=t[i];var s;n in this._global_heaps?s=this._global_heaps[n]:(s=new Ri(this.fh,n),this._global_heaps[n]=s);let l=s.objects.get(r);if("VLEN_STRING"==e){let e=this.dtype[2];const s=new TextDecoder(0==e?"ascii":"utf-8");t[i]=s.decode(l)}}}return t}_get_chunk_params(){if(!this._chunk_params_set){this._chunk_params_set=!0;var e=this.find_msg_type(Ts)[0].get("offset_to_message"),[t,i,s,n]=this._get_data_message_properties(e);if(2==s){var r;if(1==t||2==t){var l=h.unpack_from("<Q",this.fh,n)[0];r=n+h.calcsize("<Q")}else if(3==t){var[i,l]=h.unpack_from("<BQ",this.fh,n);r=n+h.calcsize("<BQ")}a(t>=1&&t<=3);var o="<"+(i-1).toFixed()+"I",d=h.unpack_from(o,this.fh,r);this._chunks=d,this._chunk_dims=i,this._chunk_address=l}}}};var Xi=h.unpack_from("<Q",new Uint8Array([255,255,255,255,255,255,255,255]).buffer),Ji=new Map([["collection_address","Q"],["object_index","I"]]),es=(n(Ji),new Map([["version","B"],["reserved","B"],["name_size","H"],["datatype_size","H"],["dataspace_size","H"]])),ts=n(es),is=new Map([["version","B"],["flags","B"],["name_size","H"],["datatype_size","H"],["dataspace_size","H"],["character_set_encoding","B"]]),ss=n(is),as=new Map([["version","B"],["reserved","B"],["total_header_messages","H"],["object_reference_count","I"],["object_header_size","I"],["padding","I"]]),ns=new Map([["signature","4s"],["version","B"],["flags","B"]]),rs=new Map([["version","B"],["dimensionality","B"],["flags","B"],["reserved_0","B"],["reserved_1","I"]]),ls=n(rs),os=new Map([["version","B"],["dimensionality","B"],["flags","B"],["type","B"]]),hs=n(os),ds=new Map([["type","H"],["size","H"],["flags","B"],["reserved","3s"]]),_s=n(ds),cs=new Map([["type","B"],["size","H"],["flags","B"]]),us=n(cs),fs=new Map([["btree_address","Q"],["heap_address","Q"]]),gs=new Map([["heap_address","Q"],["name_btree_address","Q"]]),ps=new Map([["heap_address","Q"],["name_btree_address","Q"],["order_btree_address","Q"]]),bs=new Map([["version","B"],["space_allocation_time","B"],["fillvalue_write_time","B"],["fillvalue_defined","B"]]),ms=n(bs),ws=new Map([["version","B"],["flags","B"]]),ks=n(ws),ys=new Map([["filter_id","H"],["name_length","H"],["flags","H"],["client_data_values","H"]]),vs=n(ys),xs=1,zs=2,Ls=3,Ss=5,As=6,Ts=8,Bs=11,Es=12,Cs=16,Is=17,Rs=class{constructor(e,t,i,s=!1){if(null==i?(this.parent=this,this.file=this):(this.parent=i,this.file=i.file),this.name=e,this._links=t.get_links(),this._dataobjects=t,this._attrs=null,this._keys=null,s)return new Proxy(this,Ms)}get keys(){return null==this._keys&&(this._keys=Object.keys(this._links)),this._keys.slice()}get values(){return this.keys.map((e=>this.get(e)))}length(){return this.keys.length}_dereference(e){if(!e)throw"cannot deference null reference";let t=this.file._get_object_by_address(e);if(null==t)throw"reference not found in file";return t}get(e){if("number"==typeof e)return this._dereference(e);var t=Us(e);if("/"==t)return this.file;if("."==t)return this;if(/^\//.test(t))return this.file.get(t.slice(1));if(""!=function(e){let t="/",i=e.lastIndexOf(t)+1,s=e.slice(0,i),a=new RegExp("^"+t+"+$"),n=new RegExp(t+"$");s&&!a.test(s)&&(s=s.replace(n,""));return s}(t))var[i,s]=t.split(/\/(.*)/);else var i=t,s=".";if(!(i in this._links))throw i+" not found in group";var a=Us(this.name+"/"+i);let n=this._links[i];if("string"==typeof n)try{return this.get(n)}catch(e){return null}var r=new $i(this.file._fh,n);if(r.is_dataset){if("."!=s)throw a+" is a dataset, not a group";return new Ns(a,r,this)}return new Rs(a,r,this).get(s)}visit(e){return this.visititems(((t,i)=>e(t)))}visititems(e){var t=this.name.length;/\/$/.test(this.name)||(t+=1);for(var i=this.values.slice();i;){let s=i.shift();1==i.length&&console.log(s);let a=e(s.name.slice(t),s);if(null!=a)return a;s instanceof Rs&&(i=i.concat(s.values))}return null}get attrs(){return null==this._attrs&&(this._attrs=this._dataobjects.get_attributes()),this._attrs}},Ms={get:function(e,t,i){return t in e?e[t]:e.get(t)}},Fs=class extends Rs{constructor(e,t){var i=new Ei(e,0).offset_to_dataobjects;super("/",new $i(e,i),null),this.parent=this,this._fh=e,this.filename=t||"",this.file=this,this.mode="r",this.userblock_size=0}_get_object_by_address(e){return this._dataobjects.offset==e?this:this.visititems((e=>{e._dataobjects.offset}))}},Ns=class extends Array{constructor(e,t,i){super(),this.parent=i,this.file=i.file,this.name=e,this._dataobjects=t,this._attrs=null,this._astype=null}get value(){var e=this._dataobjects.get_data();return null==this._astype?e:e.astype(this._astype)}get shape(){return this._dataobjects.shape}get attrs(){return this._dataobjects.get_attributes()}get dtype(){return this._dataobjects.dtype}get fillvalue(){return this._dataobjects.fillvalue}};function Us(e){return e.replace(/\/(\/)+/g,"/")}return i})();function round(e,t){let i=Math.pow(10,t);return Math.round(e*i)/i}function roundSF(e,t){return parseFloat(e.toPrecision(t))}function timeOffsetToDate(e,t){let i=60*e*60*1e3,s=Date.parse(t);return new Date(s+i)}function DatePlusSeconds(e,t){let i=e.getTime();return new Date(i+1e3*t)}function makeInitialisationTimeStr(e){return"Initialised "+getDateString(e)+" UTC"}function makeValidTimeStr(e,t){let i=e;return"Valid "+getDateString(i)+" to "+getDateString(DatePlusSeconds(i,60*t*60))+" UTC"}function getDateString(e){return e.getUTCFullYear()+"-"+("0"+(e.getUTCMonth()+1)).slice(-2)+"-"+("0"+e.getUTCDate()).slice(-2)+" "+("0"+e.getUTCHours()).slice(-2)+":"+("0"+e.getUTCMinutes()).slice(-2)}async function drawImageData(e,t,i,s,a,n){const r=await createImageBitmap(t);e.drawImage(r,i,s,a,n)}async function drawImageWithColourMap(e,t,i,s,a,n,r,l){const o=new Uint8ClampedArray(4*t.values.length);for(let e=0;e<t.values.length;e++){let i,s=t.values[e]/l;for(i=0;i<r.values.length&&!(s<r.values[i]);i++);i-=1,i=Math.max(i,0),i=Math.min(i,r.r.length-1),o[4*e+0]=r.r[i],o[4*e+1]=r.g[i],o[4*e+2]=r.b[i],o[4*e+3]=255}let h=new ImageData(o,t.shape[1],t.shape[0]);await drawImageData(e,h,i,s,a,n)}class colourBarSpecification{constructor(){this.showColourBar=!1,this.normalisation=1,this.barThickness=15,this.sizeFraction=.8,this.boundingBoxColour="#b3b3b3",this.boundingBoxLineWidth=1,this.plotGap=10,this.labelGap=4,this.label="",this.labelFontSize=10,this.labelFont="Arial",this.labelColour="black",this.tickLength=8,this.tickLineWidth=1,this.maxTicks=15,this.tickColour="#b3b3b3",this.tickTextFontSize=10,this.tickTextFont="Arial",this.tickTextColour="black",this.tickRoundingDP=2,this.tickLabels=[]}}class plotSpecification{constructor(){this.colourMap=defaultColourMap,this.titleSpec={titleArray:[],font:"Arial",fontSize:12,verticalSpacing:8,colour:"black"},this.colourBarSpec=new colourBarSpecification,this.boundingBoxColour="#b3b3b3",this.boundingBoxLineWidth=1,this.eraseBackground=!1,this.regionSpec=null,this.drawRegions=!1,this.regionName="",this.regionColour="#262626",this.regionLineWidth=1.25,this.drawLakes=!1,this.lakeColour="#999999",this.lakeLineWidth=1}}class barChartSpecification{constructor(){this.boxFillColour="#006699",this.boxOutlineColour="black",this.boxOutlineWidth=1,this.drawAxisBox=!0,this.axesColour="black",this.axesLineWidth=1,this.tickLabelFontSize=10,this.tickLabelFont="Arial",this.xTickSignificantFigures=3,this.xTickColour="black",this.xTickLength=8,this.xTickLineWidth=1,this.drawXTickLabels=!0,this.xTickLabelColour="black",this.xTickLabelRotated=!1,this.targetYTicks=8,this.yTickSignificantFigures=2,this.yTickColour="black",this.yTickLength=8,this.yTickLineWidth=1,this.drawYTickLabels=!0,this.yTickLabelColour="black",this.titleFontSize=12,this.titleFont="Arial",this.titleTextAlign="center",this.titleArray=[],this.titleVerticalSpacing=8,this.titleColour="black",this.drawThresholdProbability=!1,this.thresholdProbability=.95,this.thresholdProbabilityLineColour="red",this.thresholdProbabilityLineWidth=2,this.thresholdProbabilityLineDash=[],this.exceedanceValue=0,this.drawThresholdValue=!1,this.thresholdValue=0,this.thresholdValueLineColour="blue",this.thresholdValueLineWidth=2,this.thresholdValueLineDash=[],this.exceedanceProbability=0,this.dataUnits="",this.legendFont="Arial",this.legendFontSize=10,this.legendVerticalSpacing=8,this.legendTextColour="black",this.legendAlign="right",this.legendLineLength=40,this.xLabel="",this.xLabelFontSize=12,this.xLabelFont="Arial",this.xAxisLabelColour="black",this.yLabel="Count",this.yLabelFontSize=12,this.yLabelFont="Arial",this.yAxisLabelColour="black",this.drawHorizontalGridLines=!0,this.horizontalGridLineColour="#b6b6b6",this.horizontalGridLineWidth=1,this.drawVerticalGridLines=!1,this.verticalGridLineColour="#b6b6b6",this.verticalGridLineWidth=1,this.labelGap=6,this.offsetFromRightBoundary=10,this.eraseBackground=!1}}function fillOutColourBarSpecification(e){let t=new colourBarSpecification,i=Object.keys(e);for(let s=0;s<i.length;s++)t[i[s]]=e[i[s]];return t}function fillOutPlotSpecification(e){let t=new plotSpecification,i=Object.keys(e);for(let s=0;s<i.length;s++)if("titleSpec"!=i[s]&&"colourBarSpec"!=i[s])t[i[s]]=e[i[s]];else if("titleSpec"==i[s]){let i=Object.keys(e.titleSpec);for(let s=0;s<i.length;s++)t.titleSpec[i[s]]=e.titleSpec[i[s]]}else"colourBarSpec"==i[s]&&(t.colourBarSpec=fillOutColourBarSpecification(e.colourBarSpec));return t}function fillOutBarChartSpecification(e){let t=new barChartSpecification,i=Object.keys(e);for(let s=0;s<i.length;s++)t[i[s]]=e[i[s]];return t}function drawColourBar(e,t,i,s,a,n){let r=fillOutColourBarSpecification(n),l=r.normalisation;const o=r.labelFontSize;e.font=o+"pt "+r.labelFont,e.textBaseline="middle";const h=r.tickLength,d=r.maxTicks;let _,c=r.labelGap,u=r.barThickness,f=s*r.sizeFraction,g=f/a.r.length,p=0,b=0,m=[],w=Math.ceil(a.values.length/d);for(let t=0;t<a.values.length;t+=w)r.tickLabels.length>t?m[t]=r.tickLabels[t]:m[t]=round(a.values[t]*l,r.tickRoundingDP).toString(),p=e.measureText(m[t]).width,p>b&&(b=p);_=""==r.label?u+h+c+b:u+h+2*c+b+2*o;let k=t-_,y=i+s*(1-r.sizeFraction)/2;for(let t=0;t<a.r.length;t++)e.fillStyle="rgb("+a.r[t]+","+a.g[t]+","+a.b[t]+")",e.fillRect(k,f+y-g*(t+1),u,g);e.strokeStyle=r.tickColour,e.lineWidth=r.tickLineWidth,e.font=r.tickTextFontSize+"pt "+r.tickTextFont,e.fillStyle=r.tickTextColour;for(let t=0;t<a.values.length;t+=w)e.beginPath(),e.moveTo(k+u,f+y-g*t),e.lineTo(k+u+h,f+y-g*t),e.stroke(),e.fillText(m[t],k+u+h+c,f+y-g*t);return e.strokeStyle=r.boundingBoxColour,e.lineWidth=r.boundingBoxLineWidth,e.beginPath(),e.rect(k,y,u+1,f+1),e.stroke(),""!=r.label&&(e.font=o+"pt "+r.labelFont,e.fillStyle=r.labelColour,e.textAlign="center",e.translate(k+u+h+2*c+b+o,y+f/2),e.rotate(-Math.PI/2),e.fillText(r.label,0,0),e.resetTransform()),_}function setAspectRatio(e,t,i,s){let a=e[0],n=e[1],r=e[2]-e[0],l=e[3]-e[1];if("equal"==s||"number"==typeof s){let e;e="equal"==s?1:s;let o=e*i*r/t;if(o<l)n+=(l-o)/2,l=o;else{let s=t/e*(l/i);a+=(r-s)/2,r=s}}else"square"==s&&(r<l?(n+=(l-r)/2,l=r):(a+=(r-l)/2,r=l));return[a,n,a+r,n+l]}async function pcolormesh(e,t,i,s,a,n){let r=fillOutPlotSpecification(n);r.eraseBackground&&e.clearRect(t[0],t[1],t[2]-t[0],t[3]-t[1]);let l,o,h=t[0],d=t[1],_=t[2]-t[0],c=t[3]-t[1],u=r.titleSpec.fontSize,f=u+r.titleSpec.verticalSpacing,g=f*r.titleSpec.titleArray.length;e.textAlign="left",e.textBaseline="alphabetic",e.fillStyle=r.titleSpec.colour,e.font=u+"pt "+r.titleSpec.font;for(let t=0;t<r.titleSpec.titleArray.length;t++)e.fillText(r.titleSpec.titleArray[t],h,d+u+f*t);if(r.colourBarSpec.showColourBar){l=drawColourBar(e,h+_,d+g,c-g,r.colourMap,r.colourBarSpec),o=r.colourBarSpec.plotGap}else l=0,o=0;let p=min(i),b=max(i),m=[p,b],w=min(s),k=max(s),y=[w,k],v=[h,d+g,h+_-l-o,d+c];if("auto"!=r.aspectRatio){v=setAspectRatio(v,b-p,k-w,r.aspectRatio)}return await drawImageWithColourMap(e,a.flip(0),v[0],v[1],v[2]-v[0],v[3]-v[1],r.colourMap,r.colourBarSpec.normalisation),r.drawRegions&&(null==r.regionSpec?console.log("WARNING: drawRegions == true but regionSpec == null in pcolormesh"):await r.regionSpec.drawRegionList(e,v,y,m,r.regionColour,r.regionLineWidth,r.regionName)),r.drawLakes&&(null==r.regionSpec?console.log("WARNING: drawLakes == true but regionSpec == null in pcolormesh"):await r.regionSpec.drawLakes(e,v,y,m,r.lakeColour,r.lakeLineWidth)),e.strokeStyle=r.boundingBoxColour,e.lineWidth=r.boundingBoxLineWidth,e.beginPath(),e.rect(v[0],v[1],v[2]-v[0],v[3]-v[1]),e.stroke(),v}function barChart(e,t,i,s,a){let n=fillOutBarChartSpecification(a);n.eraseBackground&&e.clearRect(t[0],t[1],t[2]-t[0],t[3]-t[1]),e.textAlign=n.titleTextAlign,e.textBaseline="alphabetic",e.fillStyle=n.titleColour,e.font=n.titleFontSize+"pt "+n.titleFont;let r,l=n.titleFontSize+n.titleVerticalSpacing;"left"==n.titleTextAlign?r=t[0]:"center"==n.titleTextAlign?r=(t[0]+t[2])/2:"right"==n.titleTextAlign&&(r=t[2]);for(let i=0;i<n.titleArray.length;i++)e.fillText(n.titleArray[i],r,t[1]+n.titleFontSize+l*i);let o=l*n.titleArray.length;if(n.drawThresholdProbability){e.textAlign=n.legendAlign,e.fillStyle=n.legendTextColour,e.font=n.legendFontSize+"pt "+n.legendFont;let i,s,a=round(100*n.thresholdProbability,0)+"% chance of rainfall below "+roundSF(n.exceedanceValue,3)+" "+n.dataUnits;"left"==n.legendAlign?(i=t[0]+n.labelGap,s=t[0]+n.legendLineLength+3*n.labelGap):"center"==n.legendAlign?(i=(t[0]+t[2])/2-n.legendLineLength/2-n.labelGap/2-e.measureText(a).width/2,s=(t[0]+t[2])/2+n.legendLineLength/2+1.5*n.labelGap):(n.legendAlign="right")&&(i=t[2]-e.measureText(a).width-n.legendLineLength-2*n.labelGap,s=t[2]);let r=t[1]+n.legendFontSize/2+o;e.strokeStyle=n.thresholdProbabilityLineColour,e.lineWidth=n.thresholdProbabilityLineWidth,e.setLineDash(n.thresholdProbabilityLineDash),e.beginPath(),e.moveTo(i,r),e.lineTo(i+n.legendLineLength,r),e.stroke(),e.setLineDash([]),e.fillText(a,s,t[1]+n.legendFontSize+o),o+=n.legendFontSize+n.legendVerticalSpacing}if(n.drawThresholdValue){e.textAlign=n.legendAlign,e.fillStyle=n.legendTextColour,e.font=n.legendFontSize+"pt "+n.legendFont;let i,s,a=roundSF(n.thresholdValue,3)+" "+n.dataUnits+" exceeded with "+round(100*n.exceedanceProbability,1)+"% probability";"left"==n.legendAlign?(i=t[0]+n.labelGap,s=t[0]+n.legendLineLength+3*n.labelGap):"center"==n.legendAlign?(i=(t[0]+t[2])/2-n.legendLineLength/2-n.labelGap/2-e.measureText(a).width/2,s=(t[0]+t[2])/2+n.legendLineLength/2+1.5*n.labelGap):(n.legendAlign="right")&&(i=t[2]-e.measureText(a).width-n.legendLineLength-2*n.labelGap,s=t[2]);let r=t[1]+n.legendFontSize/2+o;e.strokeStyle=n.thresholdValueLineColour,e.lineWidth=n.thresholdValueLineWidth,e.setLineDash(n.thresholdValueLineDash),e.beginPath(),e.moveTo(i,r),e.lineTo(i+n.legendLineLength,r),e.stroke(),e.setLineDash([]),e.fillText(a,s,t[1]+n.legendFontSize+o),o+=n.legendFontSize+n.legendVerticalSpacing}let h=new Array(s.length);for(let e=0;e<s.length;e++)"number"==typeof s[e]?h[e]=roundSF(s[e],n.xTickSignificantFigures).toString():h[e]=s[e];let d,_=0;if(n.xTickLabelRotated){e.font=n.tickLabelFontSize+"pt "+n.tickLabelFont;for(let t=0;t<h.length;t++){let i=e.measureText(h[t]).width;i>_&&(_=i)}}else _=n.tickLabelFontSize;d=n.drawXTickLabels?""==n.xLabel?n.xTickLength+2*n.labelGap+_:n.xTickLength+4*n.labelGap+_+n.xLabelFontSize:""==n.xLabel?n.xTickLength+n.labelGap:n.xTickLength+2*n.labelGap+n.xLabelFontSize;let c,u=t[3]-d,f=t[1]+o,g=max(i),p=(u-f)/g,b=round(g/n.targetYTicks,0),m=0,w=0,k=[];if(n.drawYTickLabels){e.font=n.tickLabelFontSize+"pt "+n.tickLabelFont;let t=u,i=0;for(k[i]=0;t>f;)t-=b*p,i+=1,k[i]=roundSF(k[i-1]+b,n.yTickSignificantFigures+1),m=e.measureText(k[i]).width,m>w&&(w=m)}c=""==n.yLabel?n.yTickLength+1*n.labelGap+w:n.yTickLength+3*n.labelGap+w+n.yLabelFontSize;let y,v,x,z,L=t[0]+c,S=t[2]-n.offsetFromRightBoundary,A=(S-L)/(h.length-1);e.fillStyle=n.boxFillColour,e.strokeStyle=n.boxOutlineColour,e.lineWidth=n.boxOutlineWidth;for(let t=0;t<i.length;t++)y=L+t*A,v=u-i[t]*p,x=A,z=i[t]*p,e.fillRect(y,v,x,z),e.strokeRect(y,v,x,z);if(n.drawThresholdProbability){let t=0;if(n.exceedanceValue>s[s.length-2])t=A*(s.length-1.5);else{let e,i=0;for(;n.exceedanceValue>s[i];)t+=A,i+=1;e=0==i?0:(s[i]-n.exceedanceValue)/(s[i]-s[i-1]),t-=A*e}e.strokeStyle=n.thresholdProbabilityLineColour,e.lineWidth=n.thresholdProbabilityLineWidth,e.setLineDash(n.thresholdProbabilityLineDash),e.beginPath(),e.moveTo(L+t,f),e.lineTo(L+t,u),e.stroke(),e.setLineDash([])}if(n.drawThresholdValue){let t=0;if(n.thresholdValue>s[s.length-2])t=A*(s.length-1.5);else{let e,i=0;for(;n.thresholdValue>s[i];)t+=A,i+=1;e=0==i?0:(s[i]-n.thresholdValue)/(s[i]-s[i-1]),t-=A*e}e.strokeStyle=n.thresholdValueLineColour,e.lineWidth=n.thresholdValueLineWidth,e.setLineDash(n.thresholdValueLineDash),e.beginPath(),e.moveTo(L+t,f),e.lineTo(L+t,u),e.stroke(),e.setLineDash([])}e.strokeStyle=n.axesColour,e.lineWidth=n.axesLineWidth,e.beginPath(),e.moveTo(S,u),n.axesLineWidth==n.yTickLineWidth&&n.axesColour==n.yTickColour?e.lineTo(L-n.yTickLength,u):e.lineTo(L,u),e.moveTo(L,f),n.axesLineWidth==n.xTickLineWidth&&n.axesColour==n.xTickColour?e.lineTo(L,u+n.xTickLength):e.lineTo(L,u),n.drawAxisBox&&(n.axesLineWidth==n.xTickLineWidth&&n.axesColour==n.xTickColour?e.moveTo(S,u+n.xTickLength):e.moveTo(S,u),e.lineTo(S,f),e.lineTo(L,f)),e.stroke();let T,B=L,E=0;n.axesLineWidth==n.xTickLineWidth&&n.axesColour==n.xTickColour&&(B+=A,E=1),e.strokeStyle=n.xTickColour,e.lineWidth=n.xTickLineWidth;for(let t=E;t<h.length-E;t++)e.beginPath(),e.moveTo(B,u),e.lineTo(B,u+n.xTickLength),e.stroke(),B+=A;if(n.drawXTickLabels){e.textAlign="end",e.textBaseline="middle",e.fillStyle=n.xTickLabelColour,e.font=n.tickLabelFontSize+"pt "+n.tickLabelFont,B=L;for(let t=0;t<s.length;t++)e.translate(B,u+n.yTickLength+n.labelGap),e.rotate(-Math.PI/2),e.fillText(h[t],0,0),e.resetTransform(),B+=A}if(n.drawVerticalGridLines){e.strokeStyle=n.verticalGridLineColour,e.lineWidth=n.verticalGridLineWidth,B=L+A;for(let t=1;t<h.length-1;t++)e.beginPath(),e.moveTo(B,f),e.lineTo(B,u),e.stroke(),B+=A}e.textAlign="center",e.textBaseline="top",e.fillStyle=n.xAxisLabelColour,e.font=n.xLabelFontSize+"pt "+n.xLabelFont,T=n.drawXTickLabels?u+n.xTickLength+3*n.labelGap+_:u+n.xTickLength+n.labelGap,e.fillText(n.xLabel,(L+S)/2,T),e.strokeStyle=n.yTickColour,e.lineWidth=n.yTickLineWidth;let C=u;for(n.axesLineWidth==n.yTickLineWidth&&(C-=b*p);C>f;)e.beginPath(),e.moveTo(L-n.yTickLength,C),e.lineTo(L,C),e.stroke(),C-=b*p;if(n.drawYTickLabels){e.textAlign="right",e.textBaseline="middle",e.fillStyle=n.yTickLabelColour,e.font=n.tickLabelFontSize+"pt "+n.tickLabelFont,C=u;let t=0;for(;C>f;)e.fillText(k[t],L-n.yTickLength-n.labelGap,C),C-=b*p,t+=1}if(n.drawHorizontalGridLines)for(e.strokeStyle=n.horizontalGridLineColour,e.lineWidth=n.horizontalGridLineWidth,C=u-b*p;C>f;)e.beginPath(),e.moveTo(L,C),e.lineTo(S,C),e.stroke(),C-=b*p;e.textAlign="center",e.textBaseline="bottom",e.fillStyle=n.yAxisLabelColour,e.font=n.yLabelFontSize+"pt "+n.yLabelFont,e.translate(L-n.yTickLength-2*n.labelGap-w,(f+u)/2),e.rotate(-Math.PI/2),e.fillText(n.yLabel,0,0),e.resetTransform()}function max(e){let t=e[0];for(let i=1;i<e.length;i++)t<e[i]&&(t=e[i]);return t}function min(e){let t=e[0];for(let i=1;i<e.length;i++)t>e[i]&&(t=e[i]);return t}function ptInRect(e,t){return e[0]>=Math.min(t[0],t[2])&&e[0]<=Math.max(t[0],t[2])&&e[1]>=Math.min(t[1],t[3])&&e[1]<=Math.max(t[1],t[3])}function intersectRect(e,t){return!(Math.min(e[0],e[2])>Math.max(t[0],t[2])||Math.max(e[0],e[2])<Math.min(t[0],t[2])||Math.min(e[1],e[3])>Math.max(t[1],t[3])||Math.max(e[1],e[3])<Math.min(t[1],t[3]))}function findClosestIdx(e,t){let i=0,s=Math.abs(e[0]-t),a=s;for(let n=1;n<e.length;n++)s=Math.abs(e[n]-t),s<a&&(i=n,a=s);return i}function lineIntersectsRect(e,t){let i=ptInRect(e[0],t),s=ptInRect(e[1],t);if(i&&s)return{within:!0,intersectionFound:!1,line:[[e[0][0],e[0][1]],[e[1][0],e[1][1]]]};{let a,n,r=[],l=e[0][0],o=e[0][1],h=e[1][0],d=e[1][1];if(l!=h){let e=(d-o)/(h-l),i=o-e*l;a=t[0],n=e*a+i,ptInRect([a,n],[l,o,h,d])&&n>=Math.min(t[1],t[3])&&n<=Math.max(t[1],t[3])&&r.push([a,n]),a=t[2],n=e*a+i,ptInRect([a,n],[l,o,h,d])&&n>=Math.min(t[1],t[3])&&n<=Math.max(t[1],t[3])&&r.push([a,n]),n=t[1],a=(n-i)/e,ptInRect([a,n],[l,o,h,d])&&a>=Math.min(t[0],t[2])&&a<=Math.max(t[0],t[2])&&r.push([a,n]),n=t[3],a=(n-i)/e,ptInRect([a,n],[l,o,h,d])&&a>=Math.min(t[0],t[2])&&a<=Math.max(t[0],t[2])&&r.push([a,n])}else a=l,n=t[1],(n>=o&&n<=d||n>=d&&n<=o)&&a>=Math.min(t[0],t[2])&&a<=Math.max(t[0],t[2])&&r.push([a,n]),a=l,n=t[3],(n>=o&&n<=d||n>=d&&n<=o)&&a>=Math.min(t[0],t[2])&&a<=Math.max(t[0],t[2])&&r.push([a,n]);return 1==r.length?i?(h=r[0][0],d=r[0][1]):(l=r[0][0],o=r[0][1]):r.length>1&&(l=r[0][0],o=r[0][1],h=r[1][0],d=r[1][1]),{within:i||s,intersectionFound:r.length>0,line:[[l,o],[h,d]]}}}const ICPACColourMap={units:"mm/day",values:[0,1/7,10/7,30/7,50/7,100/7,200/7],r:[217,255,255,202,0,108,34],g:[217,165,255,255,254,212,139],b:[217,0,0,112,0,3,34]},KMDColourMap={units:"mm/day",values:[0,1,5,10,15,20,25,30,35,40,50,60,70,80,100],r:[255,62,57,44,26,204,182,143,69,36,255,250,238,238,145],g:[255,246,217,186,143,235,217,194,167,129,200,167,111,0,0],b:[255,0,4,40,26,253,252,229,230,197,0,0,1,5,0]},EMIColourMap={units:"mm/day",values:[0,1,5,10,20,30,50,75,100],r:[217,255,255,202,162,127,102,0,34],g:[217,165,255,255,205,255,205,255,139],b:[217,0,0,112,90,0,0,0,34]},defaultColourMap={units:"mm/day",values:[0,2.4,2.82103008,3.31592136,3.89763096,4.58138952,5.38509912,6.32980296,7.44023568,8.7454704,10.27968192,12.08303856,14.20275696,16.69433592,19.6230108,23.06546064,27.11181696,31.86802272,37.45860576,44.02994088,51.75408024,60.83325936,71.50519224,84.04929408,98.7939984,116.12535504,136.49713872,160.4427288,188.5890756,221.67311496,260.56106232,306.2710932,360],r:[255,255,250,245,241,235,226,216,207,193,175,157,139,120,104,89,73,59,50,41,32,29,31,32,33,34,35,36,36,29,22,15,8],g:[255,255,253,251,249,247,243,239,236,231,223,216,209,202,196,191,185,176,167,158,148,136,123,110,97,85,74,64,53,46,40,34,29],b:[255,217,206,196,186,177,177,178,179,180,182,184,185,187,190,192,194,195,194,193,192,187,181,175,169,163,158,153,148,133,118,103,88]},ICPACProbabilityColourMap={units:"%",values:[0,2.5,25,50,75,100],r:[217,255,255,0,34],g:[217,165,255,254,139],b:[217,0,0,0,34]},KMDProbabilityColourMap={units:"%",values:[0,2.5,25,50,75,100],r:[255,62,36,255,238],g:[255,246,129,200,0],b:[255,0,197,0,5]},EMIProbabilityColourMap={units:"%",values:[0,2.5,25,50,75,100],r:[217,255,255,162,34],g:[217,165,255,205,139],b:[217,0,0,90,34]},defaultProbabilityColourMap={units:"%",values:[0,2.5,25,50,75,100],r:[255,198,64,34,8],g:[255,233,181,93,29],b:[217,180,196,168,88]};function getColourMap(e,t){let i;return t?(i=defaultProbabilityColourMap,"ICPAC"==e?i=ICPACProbabilityColourMap:"KMD"==e?i=KMDProbabilityColourMap:"EMI"==e&&(i=EMIProbabilityColourMap)):(i=defaultColourMap,"ICPAC"==e?i=ICPACColourMap:"KMD"==e?i=KMDColourMap:"EMI"==e&&(i=EMIColourMap)),i}function getValidTimeNum(e){let t=-1;return 6==e?t=0:12==e?t=1:18==e?t=2:0==e&&(t=3),t}function getPlotNormalisation(e){let t=1;return"mm/h"==e?t=1:"mm/6h"==e?t=6:"mm/day"==e?t=24:"mm/week"==e?t=168:console.log("ERROR: Unknown units "+e+" specified."),t}class NDArray{constructor(e,t){this.shape=e.concat(),this.values=t.flat(1/0).concat()}plus(e){let t=new NDArray(this.shape,this.values);if("number"==typeof e)for(let i=0;i<t.values.length;i++)t.values[i]+=e;else for(let i=0;i<t.values.length;i++)t.values[i]+=e.values[i];return t}times(e){let t=new NDArray(this.shape,this.values);if("number"==typeof e)for(let i=0;i<t.values.length;i++)t.values[i]*=e;else for(let i=0;i<t.values.length;i++)t.values[i]*=e.values[i];return t}sum(e){let t=new Array(this.shape.length-1),i=0,s=1;for(let a=0;a<this.shape.length;a++)a!=e&&(t[i]=this.shape[a],i+=1,s*=this.shape[a]);let a=new Array(s);a.fill(0);let n=new NDArray(t,a),r=1;for(let t=e+1;t<this.shape.length;t++)r*=this.shape[t];let l=1;for(let t=0;t<e;t++)l*=this.shape[t];for(let t=0;t<l;t++)for(let i=0;i<this.shape[e];i++)for(let s=0;s<r;s++)n.values[t*r+s]+=this.values[t*this.shape[e]*r+i*r+s];return n}flip(e){let t=new NDArray(this.shape,this.values),i=1;for(let t=e+1;t<this.shape.length;t++)i*=this.shape[t];let s=1;for(let t=0;t<e;t++)s*=this.shape[t];for(let a=0;a<s;a++)for(let s=0;s<this.shape[e];s++)for(let n=0;n<i;n++)t.values[a*this.shape[e]*i+(this.shape[e]-1-s)*i+n]=this.values[a*this.shape[e]*i+s*i+n];return t}moveaxis(e){let t=new NDArray(this.shape,this.values);for(let i=0;i<this.shape.length;i++)t.shape[e[i]]=this.shape[i];let i=[];for(let t=0;t<this.shape.length;t++)i[t]=[e[t],t];i.sort((function(e,t){return e[0]-t[0]}));let s=new Array(this.shape.length);s[i[i.length-1][1]]=1;for(let e=this.shape.length-1;e>0;e--)s[i[e-1][1]]=s[i[e][1]]*t.shape[e];return this.moveaxisRecursive(t,[],s),t}moveaxisRecursive(e,t,i){let s=t.length;if(s==this.shape.length-1){let a=0,n=1,r=0;for(let e=s;e>0;e--)n*=this.shape[e],a+=t[e-1]*n,r+=t[e-1]*i[e-1];for(let t=0;t<this.shape[s];t++)e.values[r+t*i[s]]=this.values[a+t]}else{let a=t.concat();for(let t=0;t<this.shape[s];t++)a[s]=t,this.moveaxisRecursive(e,a,i)}}sort(e){let t=new NDArray(this.shape,this.values),i=1;for(let t=this.shape.length-1;t>e;t--)i*=this.shape[t];let s=new Array(this.shape[e]);for(let a=0;a<i;a++){let n=a;for(let t=0;t<this.shape[e];t++)s[t]=this.values[t*i+n];s.sort();for(let a=0;a<this.shape[e];a++)t.values[a*i+n]=s[a]}return t}slice(e,t,i){let s=this.shape.concat();s[e]=i-t;let a=1;for(let t=0;t<e;t++)a*=this.shape[t];let n=1;for(let t=e+1;t<s.length;t++)n*=this.shape[t];let r=[];for(let s=0;s<a;s++)r=r.concat(this.values.slice((s*this.shape[e]+t)*n,(s*this.shape[e]+i)*n));return new NDArray(s,r)}}class regionShapes{constructor(){this.regionNames=[],this.lakes=[],this.countryBorders=[],this.countryRegions=[]}async loadJSON(e){const t=await fetch(e);if(!t.ok)throw new Error(`Response status: ${t.status}`);return await t.json()}async loadRegionNames(e,t){0==this.regionNames.length&&(console.log("Loading region names (should happen only once)"),statusUpdate(1,"Loading region specification ..."),this.regionNames=await this.loadJSON(e+"/"+t),this.path=e,statusUpdate(0,"Region specification loaded."))}async loadLakes(){0==this.lakes.length&&(console.log("Loading lakes (should happen only once)"),statusUpdate(1,"Loading lakes ..."),this.lakes=await this.loadJSON(this.path+"/regional_lakes.json"),statusUpdate(0,"Lakes loaded."))}async loadAllCountryBorders(){if(this.countryBorders.length<this.regionNames.length){console.log("Loading country borders (should happen only once)"),statusUpdate(1,"Loading borders ...");for(let e=0;e<this.regionNames.length;e++){let t=this.regionNames[e].country,i=this.path+"/"+t+"/"+t+"_border.json";this.countryBorders.push(await this.loadJSON(i))}statusUpdate(0,"Borders loaded.")}}async loadAllRegionBorders(e){let t=!1;for(let i=0;i<this.countryRegions.length;i++)if(null!=this.countryRegions[i]&&this.countryRegions[i].country==e){t=!0;break}if(0==t){console.log("Loading regions in "+e+" (should happen only once)"),statusUpdate(1,"Loading regions in "+e+" ...");let t=this.getCountryIdx(e),i=this.getCountryIdx(e);this.countryRegions[i]={country:e,regionBorders:[]};for(let s=0;s<this.regionNames[t].region.length;s++){let a=this.regionNames[t].region[s],n=this.path+"/"+e+"/"+a+"_boundary.json";this.countryRegions[i].regionBorders.push(await this.loadJSON(n))}statusUpdate(0,"Regions in "+e+" loaded.")}}getCountryIdx(e){let t=-1;for(let i=0;i<this.regionNames.length;i++)if(this.regionNames[i].country==e){t=i;break}return t<0&&console.log("WARNING: "+e+" not found in getCountryIdx."),t}drawRegion(e,t,i,s,a,n,r){if(intersectRect([a[0],s[0],a[1],s[1]],t.bounding_box)){let l=i[2]-i[0],o=i[3]-i[1],h=s[1]-s[0],d=l/(a[1]-a[0]),_=-o/h,c=i[0]-a[0]*d,u=i[1]-s[1]*_;e.strokeStyle=n,e.lineWidth=r;let f,g,p,b,m=t.line;for(let t=0;t<m.length;t++){let s=!1;for(let a=1;a<m[t][0].length;a++){f=m[t][0][a-1]*d+c,g=m[t][1][a-1]*_+u,p=m[t][0][a]*d+c,b=m[t][1][a]*_+u;let n=lineIntersectsRect([[f,g],[p,b]],i);n.within&&!n.intersectionFound?(0==s&&(s=!0,e.beginPath(),e.moveTo(f,g)),e.lineTo(p,b)):n.intersectionFound&&(f=n.line[0][0],g=n.line[0][1],p=n.line[1][0],b=n.line[1][1],0==s?n.within?(s=!0,e.beginPath(),e.moveTo(f,g),e.lineTo(p,b)):(e.beginPath(),e.moveTo(f,g),e.lineTo(p,b),e.stroke()):(s=!1,e.lineTo(p,b),e.stroke()))}s&&e.stroke()}}}async drawRegionList(e,t,i,s,a,n,r){if("ICPAC"==r.toUpperCase()||"all"==r.toLowerCase()||"East Africa"==r){r="East Africa",await this.loadAllCountryBorders();for(let r=0;r<this.countryBorders.length;r++)this.drawRegion(e,this.countryBorders[r],t,i,s,a,n)}else{await this.loadAllRegionBorders(r);let l=this.getCountryIdx(r),o=this.countryRegions[l].regionBorders;for(let r=0;r<o.length;r++)this.drawRegion(e,o[r],t,i,s,a,n)}}async drawLakes(e,t,i,s,a,n){await this.loadLakes();for(let r=0;r<this.lakes.length;r++)this.drawRegion(e,this.lakes[r],t,i,s,a,n)}}let userStatusUpdateFunction,globalRegionSpec=new regionShapes;class countsData{constructor(){this.dataLoaded=!1,this.exceedanceProbabilityCalculated=!1,this.exceedanceProbabilityThreshold=0,this.exceedanceValueCalculated=!1,this.exceedanceProbabilityValue=0,this.regionSpec=globalRegionSpec}async loadGANForecast(e,t,i){statusUpdate(1,"Loading "+e+" ..."),this.dataLoaded=!1,this.exceedanceProbabilityCalculated=!1,this.exceedanceValueCalculated=!1;const s=await fetch(e);if(!s.ok)throw new Error(`Response status: ${s.status}`);const a=await s.arrayBuffer();let n=new hdf5.File(a,e),r=n.get("time").value;this.time=timeOffsetToDate(r,"1900-01-01T00:00:00Z");let l=n.get("valid_time").value;this.validTime=timeOffsetToDate(l,"1900-01-01T00:00:00Z"),this.ensembleMembers=n.get("counts").attrs.num_members[0],this.latitude=n.get("latitude").value,this.longitude=n.get("longitude").value,this.bins=n.get("bins").value,this.bins.unshift(0),this.bins.push(1e3),this.counts=new NDArray(n.get("counts").shape,n.get("counts").value),this.computeAndAddFirstBin(),this.counts=this.counts.moveaxis([2,0,1]),this.fileName=e,this.modelName=t,this.accumulationHours=i,this.dataLoaded=!0,statusUpdate(0,e+" loaded.")}computeAndAddFirstBin(){let e=this.counts.sum(0).times(-1).plus(this.ensembleMembers).values.concat(this.counts.values),t=this.counts.shape.concat();t[0]+=1,this.counts=new NDArray(t,e)}precipExceedanceProbability(e){if(0==this.exceedanceProbabilityCalculated||this.exceedanceProbabilityThreshold!=e){console.log("Computing exceedance probability (should happen only once per threshold)"),statusUpdate(2,"Computing exceedance probability ...");let t=e;e>this.bins[this.bins.length-2]&&(t=this.bins[this.bins.length-2]);let i=0;for(let t=0;t<this.bins.length-2&&(i+=1,!(this.bins[t]>=e));t++);let s=1-(this.bins[i]-t)/(this.bins[i]-this.bins[i-1]),a=this.longitude.length,n=this.latitude.length,r=new Array(a*n).fill(0);for(let e=0;e<n;e++)for(let t=0;t<a;t++){let n=(e*a+t)*this.counts.shape[2],l=Math.floor(this.counts.values[n+i-1]*s);for(let e=0;e<i-1;e++)l+=this.counts.values[n+e];r[e*a+t]=1-l/this.ensembleMembers}this.precipExceedanceProbability2DArray=new NDArray([n,a],r),this.exceedanceProbabilityCalculated=!0,this.exceedanceProbabilityThreshold=e,statusUpdate(0,"Exceedance probabilities computed.")}return this.precipExceedanceProbability2DArray}precipExceedanceValue(e){if(0==this.exceedanceValueCalculated||this.exceedanceProbabilityValue!=e){console.log("Computing exceedance value (should happen only once per threshold)"),statusUpdate(2,"Computing exceedance value ..."),e>1?e=1:e<0&&(e=0);let t=this.longitude.length,i=this.latitude.length,s=new Array(t*i).fill(0);for(let a=0;a<i;a++)for(let i=0;i<t;i++){let n=(a*t+i)*this.counts.shape[2],r=0,l=0;for(;r<=e*this.ensembleMembers;)r+=this.counts.values[n+l],l+=1;let o=r-this.counts.values[n+l-1],h=(e*this.ensembleMembers-o)/this.counts.values[n+l-1];s[a*t+i]=this.bins[l-1]*(1-h)+this.bins[l]*h}this.valueAtProbability2DArray=new NDArray([i,t],s),this.exceedanceValueCalculated=!0,this.exceedanceProbabilityValue=e,statusUpdate(0,"Exceedance values computed.")}return this.valueAtProbability2DArray}computeLatLonIdxBounds(e){const t=.5;let i,s,a,n;if("ICPAC"==e.toUpperCase()||"all"==e.toLowerCase()||"East Africa"==e)i=0,s=this.latitude.length,a=0,n=this.longitude.length;else{let r=this.regionSpec.getCountryIdx(e),l=this.regionSpec.regionNames[r].bounding_box[1]-t,o=this.regionSpec.regionNames[r].bounding_box[3]+t,h=this.regionSpec.regionNames[r].bounding_box[0]-t,d=this.regionSpec.regionNames[r].bounding_box[2]+t;i=findClosestIdx(this.latitude,l),s=findClosestIdx(this.latitude,o),a=findClosestIdx(this.longitude,h),n=findClosestIdx(this.longitude,d)}return[i,s,a,n]}async makePlot(e,t,i,s,a,n,r,l){statusUpdate(3,"Plotting map ...");let o=fillOutPlotSpecification(n);o.aspectRatio="equal",o.drawRegions=!0,o.drawLakes=!0,o.regionSpec=this.regionSpec;let h=o.regionName;"ICPAC"!=h.toUpperCase()&&"all"!=h.toLowerCase()||(h="East Africa");let[d,_,c,u]=this.computeLatLonIdxBounds(h);r=r.slice(0,d,_).slice(1,c,u);let f=this.latitude.slice(d,_),g=this.longitude.slice(c,u),p=[this.modelName+" forecast: "+h,l,makeInitialisationTimeStr(this.time),makeValidTimeStr(this.validTime,this.accumulationHours)];o.titleSpec.titleArray=p;let b=await pcolormesh(e,[t,i,t+s,i+a],g,f,r,o);return statusUpdate(0,"Map plotted."),b}async plotExceedenceProbability(e,t,i,s,a,n,r,l,o,h){let d=new plotSpecification;d.regionName=h,d.colourMap=getColourMap(l,!0);let _=getPlotNormalisation(r),c=this.precipExceedanceProbability(n).times(100),u="Chance of rainfall above "+roundSF(n*_,3)+" "+r;return d.colourBarSpec.tickLabels=o?["0%","2.5%","25%","50%","75%","100%"]:["None","Very low","Low","Medium","High","Certain"],d.colourBarSpec.showColourBar=!0,d.colourBarSpec.label="",await this.makePlot(e,t,i,s,a,d,c,u)}async plotExceedenceValue(e,t,i,s,a,n,r,l,o){let h=new plotSpecification;h.regionName=o,h.colourMap=getColourMap(l,!1);let d=getPlotNormalisation(r),_=this.precipExceedanceValue(n),c=round(100*n,1)+"% chance of rainfall below the plotted value.";return _=_.times(d),h.colourBarSpec.normalisation=d/24,h.colourBarSpec.showColourBar=!0,h.colourBarSpec.label="Rainfall ("+r+")",await this.makePlot(e,t,i,s,a,h,_,c)}async plotHistogram(e,t,i,s,a,n,r,l,o,h,d){let _=this.counts.slice(0,l,l+1).slice(1,o,o+1),c=getPlotNormalisation(h),u=new Array(this.bins.length);for(let e=0;e<this.bins.length-1;e++)u[e]=this.bins[e]*c;u[u.length-1]="Inf";let f=fillOutBarChartSpecification(d);f.xLabel="Rainfall ("+h+")",f.yLabel="Number of ensemble members",f.titleArray=[this.modelName+" forecast at latitude "+round(this.latitude[l],2)+", longitude "+round(this.longitude[o],2),makeInitialisationTimeStr(this.time),makeValidTimeStr(this.validTime,this.accumulationHours)],f.titleTextAlign="left",f.drawThresholdProbability=!0,f.thresholdProbability=r,f.drawThresholdValue=!0,f.thresholdValue=n*c,f.dataUnits=h,f.xTickLabelRotated=!0;let g=this.precipExceedanceProbability(n);f.exceedanceProbability=g.values[l*this.longitude.length+o];let p=this.precipExceedanceValue(r);f.exceedanceValue=p.values[l*this.longitude.length+o]*c,barChart(e,[t,i,t+s,i+a],_.values,u,f)}}function setStatusUpdateFunction(e){userStatusUpdateFunction=e}function statusUpdate(e,t){null!=userStatusUpdateFunction&&userStatusUpdateFunction(e,t)}
